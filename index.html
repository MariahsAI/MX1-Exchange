<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MX1 Exchange | Trade Smarter</title>
    
    <!-- SEO & Social Meta -->
    <meta name="description" content="MX1 Exchange - Professional cryptocurrency trading platform with real-time data, advanced charts, and AI-powered insights.">
    <meta name="keywords" content="crypto, exchange, bitcoin, ethereum, trading, MX1">
    <meta name="author" content="MX1 Exchange">
    <meta property="og:title" content="MX1 Exchange | Trade Smarter">
    <meta property="og:description" content="Professional cryptocurrency trading with real-time Binance data">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“ˆ</text></svg>">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- TradingView Widget -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
        :root {
            /* Dark Theme - Mariah AI Colors */
            --bg-primary: #0f0f1e;
            --bg-secondary: #141428;
            --bg-tertiary: #1a1a35;
            --bg-card: #12122a;
            --purple: #8a2be2;
            --cyan: #00d4ff;
            --pink: #ff1493;
            --accent-gradient: linear-gradient(135deg, #8a2be2 0%, #00d4ff 100%);
            --accent-gradient-reverse: linear-gradient(135deg, #00d4ff 0%, #8a2be2 100%);
            --purple-glow: rgba(138, 43, 226, 0.4);
            --cyan-glow: rgba(0, 212, 255, 0.3);
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #808080;
            --text-dim: #606060;
            --green: #00d4ff;
            --green-dim: rgba(0, 212, 255, 0.15);
            --red: #ff1493;
            --red-dim: rgba(255, 20, 147, 0.15);
            --border-color: rgba(0, 212, 255, 0.2);
            --border-hover: rgba(0, 212, 255, 0.4);
            --glass-bg: rgba(15, 15, 30, 0.65);
            --glass-border: rgba(0, 212, 255, 0.2);
        }

        [data-theme="light"] {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e8e8e8;
            --bg-card: #ffffff;
            --text-primary: #1a1a2e;
            --text-secondary: #4a4a5a;
            --text-muted: #6a6a7a;
            --text-dim: #9a9aaa;
            --glass-bg: rgba(255, 255, 255, 0.8);
            --glass-border: rgba(138, 43, 226, 0.3);
            --border-color: rgba(138, 43, 226, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            height: 100%;
        }

        body {
            font-family: 'Outfit', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100%;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            transition: background 0.3s, color 0.3s;
        }

        /* Background Image */
        .bg-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('bg-blockchain.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.4;
            pointer-events: none;
            z-index: 0;
            transition: opacity 0.3s;
        }

        [data-theme="light"] .bg-image {
            opacity: 0.15;
        }

        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 212, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 212, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 1;
        }

        .bg-glow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 10% 20%, rgba(0, 212, 255, 0.2) 0%, transparent 40%),
                radial-gradient(ellipse at 90% 80%, rgba(138, 43, 226, 0.25) 0%, transparent 40%),
                radial-gradient(ellipse at 50% 10%, rgba(0, 212, 255, 0.15) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
            animation: glowPulse 20s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* ===== SCROLLING TICKER ===== */
        .ticker-wrap {
            position: relative;
            z-index: 100;
            background: rgba(15, 15, 30, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
            overflow: hidden;
            height: 36px;
            flex-shrink: 0;
        }

        .ticker {
            display: flex;
            animation: ticker 30s linear infinite;
            width: max-content;
        }

        .ticker:hover {
            animation-play-state: paused;
        }

        @keyframes ticker {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .ticker-item {
            display: flex;
            align-items: center;
            padding: 8px 24px;
            gap: 8px;
            white-space: nowrap;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
        }

        .ticker-symbol {
            color: var(--text-primary);
            font-weight: 600;
        }

        .ticker-price {
            color: var(--text-secondary);
        }

        .ticker-change {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .ticker-change.positive {
            color: var(--cyan);
            background: var(--green-dim);
        }

        .ticker-change.negative {
            color: var(--pink);
            background: var(--red-dim);
        }

        /* ===== HEADER ===== */
        header {
            position: relative;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            height: 64px;
            flex-shrink: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--accent-gradient);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 14px;
            color: var(--bg-primary);
            box-shadow: 0 4px 15px var(--purple-glow);
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 1px;
        }

        nav {
            display: flex;
            gap: 8px;
            margin-left: 60px;
        }

        nav a {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        nav a:hover {
            color: var(--text-primary);
            background: rgba(0, 212, 255, 0.1);
        }

        nav a.active {
            color: var(--cyan);
            background: rgba(0, 212, 255, 0.15);
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Social Sentiment Indicator */
        .sentiment-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            margin-left: auto;
            margin-right: 12px;
        }

        .sentiment-icon {
            font-size: 18px;
        }

        .sentiment-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .sentiment-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sentiment-value {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sentiment-bar {
            width: 80px;
            height: 8px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .sentiment-fill {
            display: block;
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #8a2be2);
            border-radius: 4px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .sentiment-fill.bullish {
            background: linear-gradient(90deg, #00ff88, #00d4ff);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .sentiment-fill.bearish {
            background: linear-gradient(90deg, #ff1493, #ff6b6b);
            box-shadow: 0 0 10px rgba(255, 20, 147, 0.5);
        }

        .sentiment-fill.neutral {
            background: linear-gradient(90deg, #ffa500, #ffcc00);
            box-shadow: 0 0 10px rgba(255, 165, 0, 0.5);
        }

        .sentiment-percent {
            font-size: 13px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-primary);
        }

        .sentiment-tag {
            font-size: 10px;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 4px;
            text-transform: uppercase;
        }

        .sentiment-tag.bullish {
            background: rgba(0, 212, 255, 0.2);
            color: var(--cyan);
        }

        .sentiment-tag.bearish {
            background: rgba(255, 20, 147, 0.2);
            color: var(--pink);
        }

        .sentiment-tag.neutral {
            background: rgba(255, 165, 0, 0.2);
            color: #ffa500;
        }

        .sentiment-arrow {
            color: var(--text-muted);
            transition: transform 0.2s;
        }

        .sentiment-indicator.open .sentiment-arrow {
            transform: rotate(180deg);
        }

        /* Sentiment Dropdown */
        .sentiment-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 8px;
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px;
            display: none;
            z-index: 1000;
            min-width: 280px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .sentiment-indicator.open .sentiment-dropdown {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .sentiment-dropdown-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .sentiment-live-dot {
            width: 8px;
            height: 8px;
            background: #ff4444;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .sentiment-main-score {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .sentiment-main-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .sentiment-main-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--pink), #ffa500, var(--cyan));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .sentiment-main-percent {
            font-size: 18px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--cyan);
        }

        .sentiment-main-tag {
            font-size: 11px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 4px;
            text-transform: uppercase;
            background: rgba(0, 212, 255, 0.2);
            color: var(--cyan);
        }

        .sentiment-main-tag.bearish {
            background: rgba(255, 20, 147, 0.2);
            color: var(--pink);
        }

        .sentiment-main-tag.neutral {
            background: rgba(255, 165, 0, 0.2);
            color: #ffa500;
        }

        .sentiment-sources {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .sentiment-source {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            transition: background 0.2s;
        }

        .sentiment-source:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .source-name {
            flex: 1;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .source-value {
            font-size: 14px;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-primary);
            margin-right: 8px;
        }

        .source-trend {
            font-size: 14px;
        }

        .sentiment-footer {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--glass-border);
            font-size: 10px;
            color: var(--text-muted);
            text-align: center;
        }

        .sentiment-indicator {
            position: relative;
            cursor: pointer;
        }

        /* Theme Toggle */
        .theme-toggle {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--cyan);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .theme-toggle:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--cyan);
        }

        /* Quick Trade Header Button */
        .quick-trade-header-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 18px;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(138, 43, 226, 0.2));
            border: 1px solid var(--cyan);
            border-radius: 10px;
            color: var(--cyan);
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            position: relative;
            overflow: hidden;
        }

        .quick-trade-header-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(0, 212, 255, 0.1), transparent);
            animation: headerBtnShine 3s ease-in-out infinite;
        }

        @keyframes headerBtnShine {
            0% { transform: translateX(-100%) rotate(45deg); }
            50%, 100% { transform: translateX(100%) rotate(45deg); }
        }

        .quick-trade-header-btn:hover {
            background: var(--accent-gradient);
            color: var(--bg-primary);
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--purple-glow);
        }

        .qtb-icon {
            font-size: 14px;
        }

        .qtb-text {
            letter-spacing: 0.5px;
        }

        /* Wallet Connect Button */
        .wallet-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: var(--accent-gradient);
            border: none;
            border-radius: 10px;
            color: var(--bg-primary);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            box-shadow: 0 4px 15px var(--purple-glow);
        }

        .wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--purple-glow);
        }

        .wallet-btn.connected {
            background: rgba(0, 212, 255, 0.2);
            color: var(--cyan);
            border: 1px solid var(--cyan);
            box-shadow: none;
        }

        /* User Profile Dropdown */
        .user-profile {
            position: relative;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent-gradient);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            color: var(--bg-primary);
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .user-avatar:hover {
            border-color: var(--cyan);
            box-shadow: 0 0 20px var(--cyan-glow);
        }

        .user-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            width: 220px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 8px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s;
            z-index: 1000;
        }

        .user-profile:hover .user-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dropdown-item:hover {
            background: rgba(0, 212, 255, 0.15);
            color: var(--cyan);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--glass-border);
            margin: 8px 0;
        }

        /* ===== MAIN LAYOUT ===== */
        .main-container {
            display: flex;
            flex: 1;
            position: relative;
            z-index: 10;
            min-height: 0;
        }

        /* Center Content - Now takes full width */
        .center-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        /* Right Sidebar */
        .right-sidebar {
            width: 350px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-left: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        /* ===== MARKET DROPDOWN ===== */
        .pair-selector {
            position: relative;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
        }

        .pair-selector-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pair-selector-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--cyan);
        }

        .pair-selector-btn h2 {
            font-size: 20px;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .pair-selector-btn svg {
            color: var(--cyan);
            transition: transform 0.2s;
        }

        .pair-selector.open .pair-selector-btn svg {
            transform: rotate(180deg);
        }

        .market-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            width: 420px;
            max-height: 500px;
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s;
            z-index: 10000;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .pair-selector.open .market-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-search {
            padding: 12px;
            border-bottom: 1px solid var(--glass-border);
        }

        .dropdown-search input {
            width: 100%;
            padding: 10px 14px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
            outline: none;
            transition: border-color 0.2s;
        }

        .dropdown-search input:focus {
            border-color: var(--cyan);
        }

        .dropdown-search input::placeholder {
            color: var(--text-muted);
        }

        .dropdown-tabs {
            display: flex;
            padding: 0 12px;
            border-bottom: 1px solid var(--glass-border);
        }

        .dropdown-tab {
            padding: 10px 16px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            position: relative;
            transition: color 0.2s;
            font-family: inherit;
        }

        .dropdown-tab:hover {
            color: var(--text-secondary);
        }

        .dropdown-tab.active {
            color: var(--cyan);
        }

        .dropdown-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--cyan);
        }

        .dropdown-categories {
            display: flex;
            gap: 6px;
            padding: 10px 12px;
            border-bottom: 1px solid var(--glass-border);
            overflow-x: auto;
        }

        .dropdown-categories::-webkit-scrollbar {
            display: none;
        }

        .category-btn {
            padding: 6px 12px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid transparent;
            border-radius: 20px;
            color: var(--text-muted);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
            font-family: inherit;
        }

        .category-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            color: var(--text-secondary);
        }

        .category-btn.active {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--cyan);
            color: var(--cyan);
        }

        .dropdown-header {
            display: grid;
            grid-template-columns: 32px 1fr 100px 80px;
            gap: 10px;
            padding: 8px 12px;
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--glass-border);
        }

        .dropdown-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .dropdown-item {
            display: grid;
            grid-template-columns: 32px 1fr 100px 80px;
            gap: 10px;
            padding: 10px 12px;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid rgba(0, 212, 255, 0.05);
        }

        .dropdown-item:hover {
            background: rgba(0, 212, 255, 0.1);
        }

        .dropdown-item.active {
            background: rgba(0, 212, 255, 0.15);
        }

        .dropdown-item-star {
            color: var(--text-muted);
            cursor: pointer;
            font-size: 14px;
        }

        .dropdown-item-star.favorited {
            color: #ffd700;
        }

        .dropdown-item-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dropdown-item-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--accent-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: 700;
            color: var(--bg-primary);
        }

        .dropdown-item-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .dropdown-item-volume {
            font-size: 11px;
            color: var(--text-muted);
        }

        .dropdown-item-price {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
            text-align: right;
        }

        .dropdown-item-change {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            text-align: center;
        }

        .dropdown-item-change.positive {
            color: var(--cyan);
            background: var(--green-dim);
        }

        .dropdown-item-change.negative {
            color: var(--pink);
            background: var(--red-dim);
        }

        /* ===== CHART AREA ===== */
        .chart-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 0;
            min-height: 0;
        }

        /* Chart Header Bar - Bitunix Style */
        .chart-header-bar {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            gap: 8px;
            flex-shrink: 0;
            position: relative;
            z-index: 100;
        }

        .chart-header-bar::-webkit-scrollbar {
            display: none;
        }

        /* Stats container that can scroll */
        .header-stats-scroll {
            display: flex;
            align-items: center;
            gap: 8px;
            overflow-x: auto;
            flex: 1;
            scrollbar-width: none;
        }

        .header-stats-scroll::-webkit-scrollbar {
            display: none;
        }

        .pair-selector {
            position: relative;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            flex-shrink: 0;
            z-index: 9999;
        }

        .pair-selector-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pair-selector-btn:hover {
            background: rgba(0, 212, 255, 0.1);
            border-radius: 6px;
        }

        .pair-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--accent-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: var(--bg-primary);
        }

        .pair-selector-btn h2 {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            background: none;
            -webkit-text-fill-color: unset;
        }

        .pair-selector-btn svg {
            color: var(--text-muted);
            transition: transform 0.2s;
        }

        .pair-selector.open .pair-selector-btn svg {
            transform: rotate(180deg);
        }

        .header-divider {
            width: 1px;
            height: 28px;
            background: var(--glass-border);
            flex-shrink: 0;
        }

        .current-price {
            font-family: 'JetBrains Mono', monospace;
            font-size: 20px;
            font-weight: 700;
            color: var(--cyan);
            flex-shrink: 0;
            padding: 0 8px;
        }

        .current-price.negative {
            color: var(--pink);
        }

        .header-stat {
            display: flex;
            flex-direction: column;
            padding: 0 12px;
            flex-shrink: 0;
        }

        .header-stat-label {
            font-size: 10px;
            color: var(--text-muted);
            white-space: nowrap;
        }

        .header-stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
            white-space: nowrap;
        }

        .header-stat-value.cyan { color: var(--cyan); }
        .header-stat-value.pink { color: var(--pink); }
        .header-stat-value.positive { color: var(--cyan); }
        .header-stat-value.negative { color: var(--pink); }

        .live-badge {
            padding: 4px 10px;
            background: rgba(0, 212, 255, 0.15);
            backdrop-filter: blur(10px);
            color: var(--cyan);
            font-size: 11px;
            font-weight: 600;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            flex-shrink: 0;
        }

        .live-dot {
            width: 6px;
            height: 6px;
            background: var(--cyan);
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px var(--cyan);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }

        .header-spacer {
            flex: 1;
        }

        /* Price Alert Button */
        .alert-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: rgba(255, 20, 147, 0.15);
            border: 1px solid rgba(255, 20, 147, 0.3);
            border-radius: 8px;
            color: var(--pink);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            flex-shrink: 0;
        }

        .alert-btn:hover {
            background: rgba(255, 20, 147, 0.25);
            border-color: var(--pink);
        }

        .header-icon-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .header-icon-btn:hover {
            background: rgba(0, 212, 255, 0.1);
            color: var(--cyan);
        }

        /* Chart Content Area */
        .chart-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 16px;
            min-height: 0;
            overflow: hidden;
        }

        /* TradingView Chart */
        .tradingview-widget {
            flex: 0 0 auto;
            height: 750px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            overflow: hidden;
        }

        /* Depth Chart */
        .depth-chart-container {
            height: 100px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            margin-top: 12px;
            padding: 12px;
            position: relative;
            flex-shrink: 0;
        }

        .depth-chart-title {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        #depthChart {
            width: 100%;
            height: calc(100% - 20px);
        }

        /* ===== ORDER BOOK & TRADES ===== */
        .orderbook-trades {
            border-bottom: 1px solid var(--glass-border);
        }

        .ob-tabs {
            display: flex;
            border-bottom: 1px solid var(--glass-border);
        }

        .ob-tab {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            position: relative;
        }

        .ob-tab.active {
            color: var(--cyan);
        }

        .ob-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--cyan);
        }

        .ob-content {
            padding: 12px;
        }

        .ob-header {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            padding: 6px 0;
            margin-bottom: 6px;
        }

        .ob-header span {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ob-header span:last-child {
            text-align: right;
        }

        .ob-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            padding: 4px 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            position: relative;
            transition: all 0.2s ease;
        }

        .ob-row:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .ob-row .depth-bar {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            opacity: 0.15;
        }

        .ob-row.ask .depth-bar { background: var(--pink); }
        .ob-row.bid .depth-bar { background: var(--cyan); }
        .ob-row.ask .price { color: var(--pink); }
        .ob-row.bid .price { color: var(--cyan); }
        .ob-row .amount { color: var(--text-secondary); }
        .ob-row .total { text-align: right; color: var(--text-muted); }

        .ob-spread {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            margin: 6px 0;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 6px;
        }

        .ob-spread-main {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: 12px;
        }

        .ob-spread-price {
            font-family: 'JetBrains Mono', monospace;
            font-size: 16px;
            font-weight: 700;
            color: var(--cyan);
        }

        .ob-spread-time {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .ob-spread-label {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* Buy/Sell Ratio Bar */
        .ob-ratio-bar {
            display: flex;
            height: 24px;
            margin-top: 8px;
            border-radius: 4px;
            overflow: hidden;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            font-weight: 600;
        }

        .ob-ratio-buy {
            background: rgba(0, 212, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
            color: var(--cyan);
            transition: width 0.5s ease;
            width: 50%;
        }

        .ob-ratio-sell {
            background: rgba(255, 20, 147, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
            color: var(--pink);
            transition: width 0.5s ease;
            width: 50%;
        }

        /* Recent Trades */
        .trades-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .trade-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            padding: 6px 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.05);
            transition: all 0.3s ease;
        }

        .trade-row:hover {
            background: rgba(0, 212, 255, 0.05);
        }

        .trade-row.buy .trade-price { color: var(--cyan); }
        .trade-row.sell .trade-price { color: var(--pink); }
        .trade-row .trade-amount { color: var(--text-secondary); }
        .trade-row .trade-time { text-align: right; color: var(--text-muted); }

        /* ===== TRADE FORM ===== */
        .trade-section {
            padding: 12px;
        }

        /* Place Trades Dropdown */
        .place-trades-section {
            border-bottom: 1px solid var(--glass-border);
        }

        .place-trades-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(138, 43, 226, 0.1));
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .place-trades-header:hover {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.15), rgba(138, 43, 226, 0.15));
        }

        .place-trades-toggle {
            font-size: 12px;
            transition: transform 0.3s;
        }

        .place-trades-toggle.open {
            transform: rotate(180deg);
        }

        .trade-form-content {
            display: none;
            padding: 12px;
        }

        .trade-form-content.expanded {
            display: block;
        }

        .trade-tabs {
            display: flex;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 16px;
        }

        .trade-tab {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            font-family: inherit;
            letter-spacing: 1px;
        }

        .trade-tab.buy.active {
            background: var(--accent-gradient);
            color: var(--bg-primary);
        }

        .trade-tab.sell.active {
            background: var(--pink);
            color: white;
        }

        /* Leverage Slider */
        .leverage-section {
            margin-bottom: 16px;
        }

        .leverage-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .leverage-label {
            font-size: 12px;
            color: var(--text-muted);
        }

        .leverage-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 700;
            color: var(--cyan);
            background: rgba(0, 212, 255, 0.15);
            padding: 4px 10px;
            border-radius: 6px;
        }

        .leverage-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, var(--cyan) 0%, var(--pink) 100%);
            border-radius: 3px;
            outline: none;
            margin-bottom: 8px;
        }

        .leverage-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--text-primary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .leverage-marks {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: var(--text-muted);
        }

        /* Order Type */
        .order-types {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
        }

        .order-type-btn {
            flex: 1;
            padding: 8px;
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            font-family: inherit;
        }

        .order-type-btn.active {
            border-color: var(--cyan);
            color: var(--cyan);
            background: rgba(0, 212, 255, 0.15);
        }

        /* Form Inputs */
        .form-group {
            margin-bottom: 12px;
        }

        .form-label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .input-group {
            display: flex;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.2s;
        }

        .input-group:focus-within {
            border-color: var(--cyan);
            box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.2);
        }

        .input-group input {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            outline: none;
        }

        .input-suffix {
            display: flex;
            align-items: center;
            padding: 0 12px;
            color: var(--cyan);
            font-size: 12px;
            font-weight: 500;
            background: rgba(0, 212, 255, 0.1);
        }

        .percent-btns {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }

        .percent-btn {
            flex: 1;
            padding: 6px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
            font-family: inherit;
        }

        .percent-btn:hover {
            background: rgba(0, 212, 255, 0.25);
            border-color: var(--cyan);
            color: var(--cyan);
        }

        /* Order Summary */
        .order-summary {
            background: rgba(0, 212, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            margin: 16px 0;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 6px;
        }

        .summary-row:last-child {
            margin-bottom: 0;
        }

        .summary-row span:first-child {
            color: var(--text-muted);
        }

        .summary-row span:last-child {
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Submit Button */
        .submit-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .submit-btn.buy {
            background: var(--accent-gradient);
            color: var(--bg-primary);
            box-shadow: 0 8px 30px var(--purple-glow);
        }

        .submit-btn.sell {
            background: var(--pink);
            color: white;
            box-shadow: 0 8px 30px rgba(255, 20, 147, 0.4);
        }

        .submit-btn:hover {
            transform: translateY(-3px) scale(1.02);
            filter: brightness(1.1);
        }

        .submit-btn.buy:hover {
            box-shadow: 0 15px 40px var(--purple-glow), 0 0 30px rgba(0, 212, 255, 0.3);
        }

        .submit-btn.sell:hover {
            box-shadow: 0 15px 40px rgba(255, 20, 147, 0.5), 0 0 30px rgba(255, 20, 147, 0.3);
        }

        .submit-btn:active {
            transform: translateY(0) scale(0.98);
        }

        /* ===== BITUNIX STYLE TRADE FORM ===== */
        .trade-top-row {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .margin-select {
            flex: 1;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 13px;
            cursor: pointer;
        }

        .leverage-btn {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            cursor: pointer;
        }

        .leverage-btn span {
            color: #ff4444;
            font-weight: 700;
            font-size: 13px;
        }

        .leverage-btn:hover {
            border-color: #ff4444;
        }

        .oc-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 3px;
            margin-bottom: 12px;
        }

        .oc-tab {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .oc-tab.active {
            background: var(--cyan);
            color: #000;
        }

        .order-types-row {
            display: flex;
            gap: 16px;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--glass-border);
        }

        .ot-btn {
            padding: 6px 0;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 13px;
            cursor: pointer;
            position: relative;
        }

        .ot-btn.active {
            color: var(--text-primary);
        }

        .ot-btn.active::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--cyan);
        }

        .avail-row {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 12px;
            color: var(--text-muted);
        }

        .avail-row span:last-child {
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .input-row {
            margin-bottom: 10px;
        }

        .input-row label {
            display: block;
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .input-box {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            overflow: hidden;
        }

        .input-box input {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 15px;
            font-weight: 600;
            outline: none;
        }

        .input-box .last-btn {
            padding: 4px 10px;
            background: transparent;
            border: none;
            color: #ff4444;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        .input-box .currency {
            color: var(--text-muted);
            font-size: 12px;
            padding-right: 8px;
        }

        .input-box .spinners {
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--glass-border);
        }

        .input-box .spinners button {
            padding: 6px 12px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
        }

        .input-box .spinners button:first-child {
            border-bottom: 1px solid var(--glass-border);
        }

        .input-box .spinners button:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .qty-select {
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 12px;
            padding: 0 12px;
            cursor: pointer;
        }

        .slider-row {
            margin-bottom: 12px;
        }

        .pct-slider {
            width: 100%;
            height: 4px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
        }

        .pct-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--bg-primary);
        }

        .pct-marks {
            display: flex;
            justify-content: space-between;
            margin-top: 6px;
        }

        .pct-marks span {
            font-size: 10px;
            color: var(--text-muted);
            cursor: pointer;
        }

        .pct-marks span:hover {
            color: var(--text-primary);
        }

        .tpsl-section {
            margin-bottom: 12px;
        }

        .tpsl-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .tpsl-check {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-primary);
            cursor: pointer;
        }

        .tpsl-check input { display: none; }

        .tpsl-check .cmark {
            width: 16px;
            height: 16px;
            border: 1px solid var(--glass-border);
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tpsl-check input:checked + .cmark {
            background: var(--cyan);
            border-color: var(--cyan);
        }

        .tpsl-check input:checked + .cmark::after {
            content: 'âœ“';
            color: #000;
            font-size: 10px;
        }

        .advanced-btn {
            font-size: 11px;
            color: var(--text-muted);
            cursor: pointer;
        }

        .advanced-btn:hover {
            color: var(--text-primary);
        }

        .tpsl-inputs {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .tpsl-input-row {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            overflow: hidden;
        }

        .tpsl-label {
            padding: 12px;
            font-size: 12px;
            color: var(--text-muted);
            min-width: 30px;
        }

        .tpsl-input {
            flex: 1;
            padding: 12px 8px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            outline: none;
        }

        .tpsl-type {
            padding: 8px 12px;
            background: transparent;
            border: none;
            border-left: 1px solid var(--glass-border);
            color: var(--text-muted);
            font-size: 11px;
            cursor: pointer;
        }

        .ls-btns {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
        }

        .long-btn, .short-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .long-btn {
            background: var(--accent-gradient);
            color: #000;
        }

        .short-btn {
            background: var(--pink);
            color: #fff;
        }

        .long-btn:hover, .short-btn:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }

        .cost-row {
            display: flex;
            justify-content: space-between;
            padding-bottom: 12px;
            margin-bottom: 12px;
            border-bottom: 1px solid var(--glass-border);
        }

        .cost-left, .cost-right {
            font-size: 11px;
        }

        .cost-right { text-align: right; }

        .cost-label {
            color: var(--text-muted);
            margin-right: 4px;
        }

        .cost-row span:not(.cost-label) {
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .eff-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .eff-row span {
            font-size: 12px;
            color: var(--text-muted);
        }

        .eff-row select {
            background: transparent;
            border: 1px solid var(--glass-border);
            border-radius: 4px;
            color: var(--text-primary);
            padding: 4px 12px;
            font-size: 12px;
        }

        .vip-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .vip-icon { font-size: 24px; }

        .vip-info {
            display: flex;
            flex-direction: column;
        }

        .vip-level {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .vip-fees {
            font-size: 11px;
            color: var(--text-muted);
        }

        .margin-box {
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
        }

        .margin-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .margin-row {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 6px;
            color: var(--text-muted);
        }

        .margin-row .safe { color: #00c853; }

        /* ===== WIDGETS SECTION ===== */
        .widgets-section {
            padding: 16px;
            border-bottom: 1px solid var(--glass-border);
        }

        /* Fear & Greed Index */
        .fear-greed {
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .fear-greed:hover {
            border-color: var(--purple);
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.2);
            transform: translateY(-2px);
        }

        .fg-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .fg-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .fg-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 18px;
            font-weight: 700;
        }

        .fg-gauge {
            height: 8px;
            background: linear-gradient(to right, #ff1493, #ffa500, #00d4ff);
            border-radius: 4px;
            position: relative;
            margin-bottom: 6px;
        }

        .fg-needle {
            position: absolute;
            top: -4px;
            width: 4px;
            height: 16px;
            background: var(--text-primary);
            border-radius: 2px;
            transition: left 0.5s ease;
        }

        .fg-labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: var(--text-muted);
        }

        /* Portfolio Pie Chart */
        .portfolio-widget {
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .portfolio-widget:hover {
            border-color: var(--cyan);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
            transform: translateY(-2px);
        }

        .portfolio-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .portfolio-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .portfolio-total {
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 700;
            color: var(--cyan);
        }

        .portfolio-chart {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        #portfolioChart {
            width: 80px;
            height: 80px;
        }

        .portfolio-legend {
            flex: 1;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            margin-bottom: 4px;
        }

        .legend-color {
            width: 10px;
            height: 10px;
            border-radius: 2px;
        }

        .legend-name {
            color: var(--text-secondary);
        }

        .legend-percent {
            margin-left: auto;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-muted);
        }

        /* News Feed */
        .news-widget {
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .news-widget:hover {
            border-color: var(--pink);
            box-shadow: 0 0 20px rgba(255, 20, 147, 0.2);
            transform: translateY(-2px);
        }

        .news-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .news-item {
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
        }

        .news-item:last-child {
            border-bottom: none;
        }

        .news-headline {
            font-size: 12px;
            color: var(--text-primary);
            line-height: 1.4;
            margin-bottom: 4px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .news-headline:hover {
            color: var(--cyan);
        }

        .news-meta {
            display: flex;
            gap: 8px;
            font-size: 10px;
            color: var(--text-muted);
        }

        .news-source {
            color: var(--cyan);
        }

        /* ===== POSITIONS PANEL ===== */
        .positions-panel {
            position: relative;
            z-index: 10;
            flex-shrink: 0;
            min-height: 150px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-border);
        }

        .positions-tabs {
            display: flex;
            align-items: center;
            gap: 0;
            padding: 0 16px;
            border-bottom: 1px solid var(--glass-border);
            overflow-x: auto;
            scrollbar-width: none;
        }

        .positions-tabs::-webkit-scrollbar {
            display: none;
        }

        .positions-tab {
            padding: 14px 16px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            position: relative;
            font-family: inherit;
        }

        .positions-tab:hover {
            color: var(--text-secondary);
        }

        .positions-tab.active {
            color: var(--cyan);
        }

        .positions-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--cyan);
        }

        .positions-content {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            color: var(--text-muted);
            font-size: 13px;
        }

        /* ===== MARKET INTELLIGENCE ===== */
        .market-intelligence {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-top: 12px;
        }

        .heatmap-widget,
        .whale-widget,
        .gainers-widget {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 12px;
            min-height: 220px;
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--glass-border);
        }

        .widget-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .widget-badge {
            font-size: 9px;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .widget-badge.live {
            background: rgba(255, 0, 0, 0.2);
            color: #ff4444;
            animation: pulse 2s infinite;
        }

        /* Heatmap Grid */
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
        }

        .heatmap-cell {
            padding: 10px 6px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background 0.3s;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .heatmap-cell:hover {
            transform: scale(1.08);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        .heatmap-cell .symbol {
            font-size: 11px;
            font-weight: 700;
            color: white;
            display: block;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .heatmap-cell .change {
            font-size: 10px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.95);
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        /* Cyan theme for gains (matching site) */
        .heatmap-cell.up-strong { 
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.4), rgba(0, 255, 200, 0.3));
            border-color: rgba(0, 212, 255, 0.5);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }
        .heatmap-cell.up-medium { 
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.3), rgba(0, 255, 200, 0.2));
            border-color: rgba(0, 212, 255, 0.4);
        }
        .heatmap-cell.up-weak { 
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(0, 255, 200, 0.1));
            border-color: rgba(0, 212, 255, 0.3);
        }
        
        /* Neutral */
        .heatmap-cell.neutral { 
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Pink/Magenta theme for losses (matching site) */
        .heatmap-cell.down-weak { 
            background: linear-gradient(135deg, rgba(255, 20, 147, 0.2), rgba(255, 50, 100, 0.1));
            border-color: rgba(255, 20, 147, 0.3);
        }
        .heatmap-cell.down-medium { 
            background: linear-gradient(135deg, rgba(255, 20, 147, 0.3), rgba(255, 50, 100, 0.2));
            border-color: rgba(255, 20, 147, 0.4);
        }
        .heatmap-cell.down-strong { 
            background: linear-gradient(135deg, rgba(255, 20, 147, 0.4), rgba(255, 50, 100, 0.3));
            border-color: rgba(255, 20, 147, 0.5);
            box-shadow: 0 0 15px rgba(255, 20, 147, 0.3);
        }

        /* Whale Feed */
        .whale-feed {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 180px;
            overflow-y: auto;
        }

        .whale-alert {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            font-size: 12px;
            animation: slideInLeft 0.3s ease;
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .whale-alert .icon {
            font-size: 18px;
        }

        .whale-alert .details {
            flex: 1;
        }

        .whale-alert .title {
            color: var(--text-primary);
            font-weight: 500;
        }

        .whale-alert .subtitle {
            color: var(--text-muted);
            font-size: 10px;
            margin-top: 2px;
        }

        .whale-alert .value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            font-size: 11px;
        }

        .whale-alert.whale .value { color: var(--cyan); }
        .whale-alert.liquidation-long .value { color: #ff4444; }
        .whale-alert.liquidation-short .value { color: #00c853; }

        /* Top Movers */
        .movers-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .movers-column {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            padding: 10px;
        }

        .movers-header {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--glass-border);
        }

        .movers-column.gainers .movers-header { color: #00c853; }
        .movers-column.losers .movers-header { color: #ff4444; }

        .movers-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .mover-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
            font-size: 12px;
        }

        .mover-row .coin {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .mover-row .coin-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--glass-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: 700;
        }

        .mover-row .coin-symbol {
            font-weight: 600;
            color: var(--text-primary);
        }

        .mover-row .change {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }

        .mover-row .change.positive { color: #00c853; }
        .mover-row .change.negative { color: #ff4444; }

        /* Technical Analysis Widget */
        .ta-widget {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 12px;
        }

        .ta-symbol {
            font-size: 11px;
            font-weight: 600;
            color: var(--cyan);
            background: rgba(0, 212, 255, 0.15);
            padding: 3px 8px;
            border-radius: 4px;
        }

        .ta-content {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ta-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .ta-label {
            font-size: 12px;
            color: var(--text-muted);
            min-width: 70px;
        }

        .ta-bar-container {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .ta-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s, background 0.3s;
        }

        .ta-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            font-weight: 600;
            min-width: 60px;
            text-align: right;
        }

        .ta-signal {
            font-size: 11px;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 4px;
        }

        .ta-signal.bullish {
            background: rgba(0, 212, 255, 0.2);
            color: var(--cyan);
        }

        .ta-signal.bearish {
            background: rgba(255, 20, 147, 0.2);
            color: var(--pink);
        }

        .ta-signal.neutral {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-muted);
        }

        .ta-levels {
            display: flex;
            gap: 12px;
            margin-top: 6px;
            padding-top: 10px;
            border-top: 1px solid var(--glass-border);
        }

        .ta-level {
            flex: 1;
            text-align: center;
            padding: 8px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.03);
        }

        .ta-level .level-label {
            font-size: 10px;
            color: var(--text-muted);
            display: block;
            margin-bottom: 4px;
        }

        .ta-level .level-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            font-weight: 600;
        }

        .ta-level.support .level-value { color: var(--cyan); }
        .ta-level.resistance .level-value { color: var(--pink); }

        .ta-summary {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.03);
            margin-top: 6px;
        }

        .ta-summary .summary-label {
            font-size: 12px;
            color: var(--text-muted);
        }

        .ta-summary .summary-value {
            font-size: 13px;
            font-weight: 700;
        }

        .ta-summary.bullish { border: 1px solid rgba(0, 212, 255, 0.3); }
        .ta-summary.bullish .summary-value { color: var(--cyan); }
        .ta-summary.bearish { border: 1px solid rgba(255, 20, 147, 0.3); }
        .ta-summary.bearish .summary-value { color: var(--pink); }
        .ta-summary.neutral { border: 1px solid rgba(255, 255, 255, 0.1); }
        .ta-summary.neutral .summary-value { color: var(--text-secondary); }

        /* Funding Rates Widget */
        .funding-widget {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 12px;
        }

        .funding-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .funding-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
        }

        .funding-row .coin {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 13px;
        }

        .funding-row .coin-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--glass-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: 700;
        }

        .funding-row .rate {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            font-weight: 600;
        }

        .funding-row .rate.positive { color: #00c853; }
        .funding-row .rate.negative { color: #ff4444; }

        .funding-row .indicator {
            font-size: 14px;
        }

        .funding-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px solid var(--glass-border);
        }

        .funding-hint {
            font-size: 9px;
            color: var(--text-muted);
        }

        /* Economic Calendar Widget */
        .calendar-widget {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 12px;
        }

        .calendar-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .calendar-event {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border-left: 3px solid var(--glass-border);
        }

        .calendar-event.high { border-left-color: #ff4444; }
        .calendar-event.medium { border-left-color: #ffaa00; }
        .calendar-event.low { border-left-color: #00c853; }

        .calendar-event .event-date {
            text-align: center;
            min-width: 45px;
        }

        .calendar-event .event-day {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .calendar-event .event-month {
            font-size: 9px;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .calendar-event .event-details {
            flex: 1;
        }

        .calendar-event .event-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .calendar-event .event-time {
            font-size: 10px;
            color: var(--text-muted);
        }

        .calendar-event .event-impact {
            font-size: 9px;
            font-weight: 600;
            padding: 3px 6px;
            border-radius: 4px;
        }

        .calendar-event.high .event-impact {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }

        .calendar-event.medium .event-impact {
            background: rgba(255, 170, 0, 0.2);
            color: #ffaa00;
        }

        .calendar-event.low .event-impact {
            background: rgba(0, 200, 83, 0.2);
            color: #00c853;
        }

        /* ===== FOOTER ===== */
        .footer-brand {
            text-align: center;
            padding: 8px;
            font-size: 10px;
            color: var(--cyan);
            font-weight: 300;
            letter-spacing: 3px;
            text-transform: uppercase;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--glass-border);
        }

        /* ===== MODALS ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 24px;
            max-width: 420px;
            width: 90%;
            transform: scale(0.9);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: rgba(255, 20, 147, 0.2);
            color: var(--pink);
        }

        /* Wallet Modal */
        .wallet-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .wallet-option {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px;
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .wallet-option:hover {
            background: rgba(0, 212, 255, 0.15);
            border-color: var(--cyan);
        }

        .wallet-option-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .wallet-option-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .wallet-option-desc {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Order Confirmation Modal */
        .confirm-details {
            background: rgba(0, 212, 255, 0.05);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .confirm-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
        }

        .confirm-row:last-child {
            border-bottom: none;
        }

        .confirm-label {
            color: var(--text-muted);
            font-size: 13px;
        }

        .confirm-value {
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            font-weight: 600;
        }

        .confirm-btns {
            display: flex;
            gap: 12px;
        }

        .confirm-btns button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .confirm-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .confirm-submit {
            background: var(--accent-gradient);
            color: var(--bg-primary);
        }

        /* Price Alert Modal */
        .alert-types {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .alert-type-btn {
            flex: 1;
            padding: 10px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-muted);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .alert-type-btn.active {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--cyan);
            color: var(--cyan);
        }

        .alert-input-group {
            margin-bottom: 16px;
        }

        .alert-input-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .alert-save-btn {
            width: 100%;
            padding: 14px;
            background: var(--accent-gradient);
            border: none;
            border-radius: 10px;
            color: var(--bg-primary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
        }

        /* ===== AI CHAT BUBBLE ===== */
        .ai-chat-bubble {
            position: fixed;
            bottom: 80px;
            right: 24px;
            z-index: 1000;
        }

        .ai-chat-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-gradient);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 30px var(--purple-glow);
            transition: all 0.3s;
        }

        .ai-chat-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 40px var(--purple-glow);
        }

        .ai-chat-btn svg {
            color: var(--bg-primary);
        }

        .ai-chat-window {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 350px;
            height: 450px;
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s;
        }

        .ai-chat-bubble.open .ai-chat-window {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .ai-chat-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--accent-gradient);
            color: var(--bg-primary);
        }

        .ai-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .ai-info h4 {
            font-size: 14px;
            font-weight: 700;
        }

        .ai-info span {
            font-size: 11px;
            opacity: 0.8;
        }

        .ai-chat-messages {
            flex: 1;
            padding: 16px;
            height: 320px;
            overflow-y: auto;
        }

        .ai-message {
            margin-bottom: 12px;
            max-width: 85%;
        }

        .ai-message.bot {
            background: rgba(0, 212, 255, 0.1);
            border-radius: 12px 12px 12px 4px;
            padding: 12px;
            color: var(--text-primary);
            font-size: 13px;
            line-height: 1.5;
        }

        .ai-message.user {
            background: var(--accent-gradient);
            border-radius: 12px 12px 4px 12px;
            padding: 12px;
            color: var(--bg-primary);
            font-size: 13px;
            margin-left: auto;
        }

        .ai-chat-input {
            display: flex;
            padding: 12px;
            border-top: 1px solid var(--glass-border);
        }

        .ai-chat-input input {
            flex: 1;
            padding: 10px 14px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            color: var(--text-primary);
            font-size: 13px;
            outline: none;
        }

        .ai-chat-input button {
            width: 40px;
            height: 40px;
            background: var(--accent-gradient);
            border: none;
            border-radius: 50%;
            color: var(--bg-primary);
            margin-left: 8px;
            cursor: pointer;
        }

        /* ===== TOAST NOTIFICATIONS ===== */
        .toast-container {
            position: fixed;
            top: 120px;
            right: 24px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 18px;
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            min-width: 300px;
            animation: slideIn 0.3s ease;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-color: var(--cyan);
        }

        .toast.error {
            border-color: var(--pink);
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toast.success .toast-icon {
            background: var(--green-dim);
            color: var(--cyan);
        }

        .toast.error .toast-icon {
            background: var(--red-dim);
            color: var(--pink);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .toast-message {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* ===== KEYBOARD SHORTCUTS HINT ===== */
        .shortcuts-hint {
            position: fixed;
            bottom: 24px;
            left: 24px;
            z-index: 100;
            display: flex;
            gap: 12px;
        }

        .shortcut-key {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            font-size: 11px;
            color: var(--text-muted);
        }

        .shortcut-key kbd {
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--cyan);
        }

        /* ===== EPIC EFFECTS ===== */

        /* Loading Skeleton */
        .skeleton {
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.05) 25%,
                rgba(255, 255, 255, 0.1) 50%,
                rgba(255, 255, 255, 0.05) 75%
            );
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-text {
            height: 14px;
            width: 80px;
            margin: 4px 0;
        }

        .skeleton-text.short { width: 50px; }
        .skeleton-text.long { width: 120px; }

        .skeleton-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        .skeleton-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
        }

        .skeleton-price {
            height: 20px;
            width: 100px;
        }

        /* Smooth Number Animation */
        .animated-number {
            display: inline-block;
            transition: transform 0.2s ease;
        }

        .animated-number.counting-up {
            color: var(--cyan);
        }

        .animated-number.counting-down {
            color: var(--pink);
        }

        /* Sound Toggle Button */
        .sound-toggle {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--cyan);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .sound-toggle:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--cyan);
        }

        .sound-toggle.muted {
            color: var(--text-muted);
            border-color: var(--text-muted);
        }

        .sound-toggle.muted:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Price Flash Animation */
        .price-flash {
            animation: priceFlash 0.5s ease;
        }

        .price-flash.up {
            animation: priceFlashUp 0.5s ease;
        }

        .price-flash.down {
            animation: priceFlashDown 0.5s ease;
        }

        @keyframes priceFlashUp {
            0% { color: var(--cyan); text-shadow: 0 0 20px var(--cyan); transform: scale(1.1); }
            100% { color: var(--cyan); text-shadow: none; transform: scale(1); }
        }

        @keyframes priceFlashDown {
            0% { color: var(--pink); text-shadow: 0 0 20px var(--pink); transform: scale(1.1); }
            100% { color: var(--pink); text-shadow: none; transform: scale(1); }
        }

        /* Particle Canvas */
        #particleCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            pointer-events: none;
            z-index: 99999;
            animation: confettiFall 3s ease-out forwards;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(0) rotateZ(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotateZ(720deg);
                opacity: 0;
            }
        }

        /* Button Ripple Effect */
        .ripple-btn {
            position: relative;
            overflow: hidden;
        }

        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: scale(0);
            animation: rippleEffect 0.6s ease-out;
            pointer-events: none;
        }

        @keyframes rippleEffect {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Glowing Border Animation */
        .glow-border {
            position: relative;
        }

        .glow-border::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--cyan), var(--purple), var(--pink), var(--cyan));
            background-size: 400% 400%;
            border-radius: inherit;
            z-index: -1;
            animation: glowRotate 3s linear infinite;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .glow-border:hover::before {
            opacity: 1;
        }

        @keyframes glowRotate {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Number Roll Animation */
        .number-roll {
            display: inline-block;
            transition: transform 0.3s ease;
        }

        .number-roll.changing {
            animation: numberRoll 0.3s ease;
        }

        @keyframes numberRoll {
            0% { transform: translateY(-10px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        /* Hover Tilt Effect */
        .tilt-card {
            transition: transform 0.2s ease;
            transform-style: preserve-3d;
        }

        .tilt-card:hover {
            transform: perspective(1000px) rotateX(2deg) rotateY(2deg);
        }

        /* Pulse Glow on Success */
        .success-pulse {
            animation: successPulse 0.5s ease;
        }

        @keyframes successPulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 212, 255, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(0, 212, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 212, 255, 0); }
        }

        /* ===== FLOATING QUICK TRADE BUTTON ===== */
        .quick-trade-fab {
            position: fixed;
            bottom: 120px;
            right: 370px;
            background: var(--accent-gradient);
            border-radius: 50px;
            padding: 14px 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            box-shadow: 0 8px 32px var(--purple-glow), 0 0 20px rgba(0, 212, 255, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            animation: fabPulse 2s ease-in-out infinite;
        }

        @keyframes fabPulse {
            0%, 100% { box-shadow: 0 8px 32px var(--purple-glow), 0 0 20px rgba(0, 212, 255, 0.3); }
            50% { box-shadow: 0 8px 40px var(--purple-glow), 0 0 40px rgba(0, 212, 255, 0.5); }
        }

        .quick-trade-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 48px var(--purple-glow), 0 0 50px rgba(0, 212, 255, 0.5);
        }

        .fab-icon {
            font-size: 20px;
        }

        .fab-text {
            font-weight: 700;
            font-size: 14px;
            color: var(--bg-primary);
            letter-spacing: 1px;
        }

        .fab-hint {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            color: var(--cyan);
            opacity: 0;
            transition: opacity 0.2s;
            white-space: nowrap;
        }

        .quick-trade-fab:hover .fab-hint {
            opacity: 1;
        }

        /* Shortcuts Hint Bar - Hidden by default, shows on Trade button hover */
        .shortcuts-hint {
            display: none; /* Hidden - keyboard shortcuts shown in modal */
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 8px 20px;
            text-align: center;
            font-size: 11px;
            color: var(--text-muted);
            z-index: 999;
            border-top: 1px solid var(--glass-border);
        }

        .shortcuts-hint b {
            color: var(--cyan);
            background: rgba(0, 212, 255, 0.15);
            padding: 2px 6px;
            border-radius: 3px;
            margin: 0 2px;
        }

        /* ===== QUICK TRADE MODAL ===== */
        .quick-trade-modal {
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            width: 420px;
            max-width: 95vw;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5), 0 0 40px var(--purple-glow);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .qtm-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(138, 43, 226, 0.1));
            border-bottom: 1px solid var(--glass-border);
        }

        .qtm-pair {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .qtm-symbol {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .qtm-price {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--cyan);
        }

        .qtm-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .qtm-close:hover {
            background: rgba(255, 20, 147, 0.2);
            border-color: var(--pink);
            color: var(--pink);
        }

        /* Mini Order Book */
        .qtm-mini-book {
            padding: 16px 20px;
            border-bottom: 1px solid var(--glass-border);
        }

        .qtm-row {
            display: flex;
            justify-content: space-between;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            padding: 4px 0;
        }

        .qtm-row.ask span:first-child { color: var(--pink); }
        .qtm-row.bid span:first-child { color: var(--cyan); }
        .qtm-row span:last-child { color: var(--text-muted); }

        .qtm-spread {
            text-align: center;
            font-size: 10px;
            color: var(--text-muted);
            padding: 8px 0;
            border-top: 1px dashed var(--glass-border);
            border-bottom: 1px dashed var(--glass-border);
            margin: 8px 0;
        }

        /* Form */
        .qtm-form {
            padding: 20px;
        }

        .qtm-leverage {
            margin-bottom: 16px;
        }

        .qtm-leverage > span {
            font-size: 12px;
            color: var(--text-muted);
            display: block;
            margin-bottom: 8px;
        }

        .qtm-lev-btns {
            display: flex;
            gap: 8px;
        }

        .qtm-lev-btns button {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-muted);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .qtm-lev-btns button:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: var(--cyan);
            color: var(--cyan);
        }

        .qtm-lev-btns button.active {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--cyan);
            color: var(--cyan);
        }

        .qtm-amount {
            margin-bottom: 20px;
        }

        .qtm-amount label {
            font-size: 12px;
            color: var(--text-muted);
            display: block;
            margin-bottom: 8px;
        }

        .qtm-amount-row {
            display: flex;
            gap: 10px;
        }

        .qtm-amount-row input {
            flex: 1;
            padding: 14px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 18px;
            font-weight: 600;
            outline: none;
            transition: all 0.2s;
        }

        .qtm-amount-row input:focus {
            border-color: var(--cyan);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
        }

        .qtm-quick-amounts {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .qtm-quick-amounts button {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            color: var(--text-muted);
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .qtm-quick-amounts button:hover {
            background: rgba(0, 212, 255, 0.15);
            color: var(--cyan);
        }

        /* TP/SL in Quick Trade */
        .qtm-tpsl {
            margin-bottom: 16px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            border: 1px solid var(--glass-border);
        }

        .qtm-tpsl-header {
            margin-bottom: 12px;
        }

        .qtm-tpsl-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
        }

        .qtm-tpsl-toggle input {
            display: none;
        }

        .qtm-checkmark {
            width: 18px;
            height: 18px;
            border: 2px solid var(--glass-border);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .qtm-tpsl-toggle input:checked + .qtm-checkmark {
            background: var(--cyan);
            border-color: var(--cyan);
        }

        .qtm-tpsl-toggle input:checked + .qtm-checkmark::after {
            content: 'âœ“';
            color: #000;
            font-size: 12px;
            font-weight: bold;
        }

        .qtm-tpsl-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .qtm-tpsl-inputs.hidden {
            display: none;
        }

        .qtm-tpsl-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .qtm-tpsl-label {
            width: 24px;
            font-size: 12px;
            font-weight: 700;
        }

        .qtm-tpsl-label.tp {
            color: var(--cyan);
        }

        .qtm-tpsl-label.sl {
            color: var(--pink);
        }

        .qtm-tpsl-row input {
            width: 90px;
            padding: 8px 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            outline: none;
            transition: all 0.2s;
        }

        .qtm-tpsl-row input:focus {
            border-color: var(--cyan);
        }

        .qtm-tpsl-row input::placeholder {
            color: var(--text-muted);
            font-size: 10px;
        }

        .qtm-tpsl-pct {
            width: 45px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            text-align: right;
            color: var(--text-muted);
        }

        .qtm-quick-pct {
            display: flex;
            gap: 4px;
        }

        .qtm-quick-pct button {
            padding: 6px 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .qtm-tpsl-row:first-child .qtm-quick-pct button {
            color: var(--cyan);
        }

        .qtm-tpsl-row:last-child .qtm-quick-pct button {
            color: var(--pink);
        }

        .qtm-quick-pct button:hover {
            background: rgba(0, 212, 255, 0.15);
            border-color: var(--cyan);
            transform: scale(1.05);
        }

        .qtm-tpsl-row:last-child .qtm-quick-pct button:hover {
            background: rgba(255, 20, 147, 0.15);
            border-color: var(--pink);
        }

        .qtm-quick-pct button.active {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--cyan);
        }

        .qtm-tpsl-row:last-child .qtm-quick-pct button.active {
            background: rgba(255, 20, 147, 0.2);
            border-color: var(--pink);
        }

        .qtm-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .qtm-long, .qtm-short {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .qtm-long {
            background: var(--accent-gradient);
            color: var(--bg-primary);
        }

        .qtm-short {
            background: var(--pink);
            color: white;
        }

        .qtm-long:hover, .qtm-short:hover {
            transform: translateY(-3px);
            filter: brightness(1.1);
        }

        .qtm-long:active, .qtm-short:active {
            transform: scale(0.98);
        }

        .qtm-btn-hint {
            font-size: 10px;
            opacity: 0.7;
        }

        .qtm-info {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-muted);
        }

        .qtm-info b {
            color: var(--text-primary);
        }

        .qtm-shortcuts {
            text-align: center;
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--glass-border);
        }

        .qtm-shortcuts span {
            background: rgba(0, 212, 255, 0.15);
            color: var(--cyan);
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1200px) {
            .right-sidebar {
                width: 320px;
            }
            .header-stat {
                padding: 0 8px;
            }
            .quick-trade-fab {
                right: 340px;
            }
        }

        @media (max-width: 900px) {
            .main-container {
                flex-direction: column;
            }
            .right-sidebar {
                width: 100%;
                max-height: none;
                border-left: none;
                border-top: 1px solid var(--glass-border);
            }
            .quick-trade-fab {
                right: 20px;
                bottom: 80px;
            }
            nav {
                display: none;
            }
            .sentiment-indicator {
                display: none;
            }
            .chart-stats {
                display: none;
            }
            .shortcuts-hint {
                display: none;
            }
            .market-dropdown {
                width: 100vw;
                left: -16px;
                border-radius: 0 0 12px 12px;
            }
            .tradingview-widget {
                height: 500px;
            }
            .depth-chart-container {
                height: 80px;
            }
            .positions-panel {
                min-height: 100px;
            }
            .header-stats-scroll {
                max-width: calc(100vw - 250px);
            }
            .widgets-section {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }
            .fear-greed, .portfolio-widget, .news-widget {
                margin-bottom: 0;
            }
            .news-widget {
                grid-column: span 2;
            }
            .market-intelligence {
                grid-template-columns: 1fr;
            }
            .heatmap-widget, .whale-widget, .gainers-widget {
                min-height: 200px;
            }
        }

        @media (max-width: 600px) {
            .ticker-wrap {
                display: none;
            }
            header {
                padding: 0 12px;
                height: 56px;
            }
            .logo-text {
                display: none;
            }
            .wallet-btn span {
                display: none;
            }
            .ai-chat-window {
                width: calc(100vw - 40px);
                right: -10px;
            }
            .chart-header-bar {
                padding: 8px 12px;
                flex-wrap: wrap;
                gap: 6px;
            }
            .pair-selector-btn h2 {
                font-size: 16px;
            }
            .current-price {
                font-size: 16px;
            }
            .header-stat {
                padding: 0 6px;
            }
            .header-stat-label {
                font-size: 9px;
            }
            .header-stat-value {
                font-size: 11px;
            }
            .live-badge {
                padding: 3px 8px;
                font-size: 10px;
            }
            .header-divider {
                display: none;
            }
            .tradingview-widget {
                height: 300px;
            }
            .trade-section {
                padding: 12px;
            }
            .leverage-section {
                margin-bottom: 12px;
            }
            .widgets-section {
                grid-template-columns: 1fr;
                padding: 12px;
            }
            .news-widget {
                grid-column: span 1;
            }
            .ob-content {
                padding: 8px;
            }
            .ob-row {
                font-size: 11px;
            }
            .market-dropdown {
                left: -12px;
            }
            .modal {
                width: 95%;
                padding: 16px;
            }
            .toast-container {
                right: 12px;
                left: 12px;
            }
            .toast {
                min-width: auto;
            }
            .ai-chat-bubble {
                bottom: 70px;
                right: 12px;
            }
            .ai-chat-btn {
                width: 50px;
                height: 50px;
            }
            .footer-brand {
                font-size: 9px;
                letter-spacing: 2px;
            }
        }

        @media (max-width: 400px) {
            .header-actions {
                gap: 6px;
            }
            .sound-toggle, .theme-toggle {
                width: 36px;
                height: 36px;
            }
            .user-avatar {
                width: 36px;
                height: 36px;
                font-size: 12px;
            }
            .pair-selector-btn {
                padding: 4px 8px;
            }
            .pair-icon {
                width: 24px;
                height: 24px;
                font-size: 8px;
            }
            .pair-selector-btn h2 {
                font-size: 14px;
            }
            .submit-btn {
                padding: 12px;
                font-size: 13px;
            }
        }
            .pair-selector-btn h2 {
                font-size: 16px;
            }
            .market-dropdown {
                width: 100vw;
                left: -12px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-image"></div>
    <div class="bg-grid"></div>
    <div class="bg-glow"></div>
    <canvas id="particleCanvas"></canvas>

    <!-- Scrolling Ticker -->
    <div class="ticker-wrap">
        <div class="ticker" id="ticker">
            <!-- Filled by JS -->
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="logo">
            <div class="logo-icon">MX1</div>
            <div class="logo-text">MX1 EXCHANGE</div>
        </div>
        <nav>
            <a href="#" class="active">Trade</a>
            <a href="#">Markets</a>
            <a href="#">Futures</a>
            <a href="#">Earn</a>
            <a href="#">Copy Trading</a>
        </nav>
        
        <!-- Social Sentiment Indicator -->
        <div class="sentiment-indicator" id="sentimentIndicator" onclick="toggleSentimentDropdown()">
            <div class="sentiment-icon" id="sentimentIcon">ðŸ“ˆ</div>
            <div class="sentiment-info">
                <span class="sentiment-label"><span id="sentimentSymbol">BTC</span> SENTIMENT</span>
                <span class="sentiment-value">
                    <span class="sentiment-bar">
                        <span class="sentiment-fill bullish" id="sentimentFill" style="width: 78%;"></span>
                    </span>
                    <span class="sentiment-percent" id="sentimentPercent">78%</span>
                    <span class="sentiment-tag bullish" id="sentimentTag">Bullish</span>
                </span>
            </div>
            <svg class="sentiment-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
            
            <!-- Sentiment Dropdown -->
            <div class="sentiment-dropdown" id="sentimentDropdown">
                <div class="sentiment-dropdown-header">
                    <span id="sentimentDropdownSymbol">BTC</span> Social Sentiment
                    <span class="sentiment-live-dot"></span>
                </div>
                <div class="sentiment-main-score">
                    <div class="sentiment-main-bar">
                        <div class="sentiment-main-fill" id="sentimentMainFill" style="width: 78%;"></div>
                    </div>
                    <span class="sentiment-main-percent" id="sentimentMainPercent">78%</span>
                    <span class="sentiment-main-tag" id="sentimentMainTag">Bullish</span>
                </div>
                <div class="sentiment-sources">
                    <div class="sentiment-source">
                        <span class="source-name">Twitter</span>
                        <span class="source-value" id="sentimentTwitter">82%</span>
                        <span class="source-trend bullish">ðŸ“ˆ</span>
                    </div>
                    <div class="sentiment-source">
                        <span class="source-name">Reddit</span>
                        <span class="source-value" id="sentimentReddit">74%</span>
                        <span class="source-trend bullish">ðŸ“ˆ</span>
                    </div>
                    <div class="sentiment-source">
                        <span class="source-name">News</span>
                        <span class="source-value" id="sentimentNews">71%</span>
                        <span class="source-trend bullish">ðŸ“ˆ</span>
                    </div>
                    <div class="sentiment-source">
                        <span class="source-name">Telegram</span>
                        <span class="source-value" id="sentimentTelegram">79%</span>
                        <span class="source-trend bullish">ðŸ“ˆ</span>
                    </div>
                </div>
                <div class="sentiment-footer" id="sentimentFooter">
                    Checking data source...
                </div>
            </div>
        </div>
        
        <div class="header-actions">
            <button class="sound-toggle" id="soundToggle" onclick="toggleSound()" title="Toggle Sound">
                <svg id="soundIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                </svg>
            </button>
            <button class="quick-trade-header-btn" onclick="openQuickTrade()" title="Quick Trade (T)">
                <span class="qtb-icon">âš¡</span>
                <span class="qtb-text">Trade</span>
            </button>
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                <svg id="themeIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"></circle>
                    <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
                </svg>
            </button>
            <button class="wallet-btn" id="walletBtn" onclick="openWalletModal()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                    <path d="M16 12h.01"></path>
                </svg>
                <span>Connect Wallet</span>
            </button>
            <div class="user-profile">
                <div class="user-avatar">JD</div>
                <div class="user-dropdown">
                    <div class="dropdown-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Profile
                    </div>
                    <div class="dropdown-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                            <path d="M16 12h.01"></path>
                        </svg>
                        Wallets
                    </div>
                    <div class="dropdown-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                        </svg>
                        Settings
                    </div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        Logout
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Center Content -->
        <div class="center-content">
            <!-- Chart Header Bar - Bitunix Style -->
            <div class="chart-header-bar">
                <!-- Pair Selector Dropdown -->
                <div class="pair-selector" id="pairSelector">
                    <div class="pair-selector-btn" onclick="togglePairDropdown()">
                        <div class="pair-icon" id="pairIcon">BTC</div>
                        <h2 id="selectedPair">BTCUSDT</h2>
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="market-dropdown">
                        <div class="dropdown-search">
                            <input type="text" placeholder="Search pairs..." id="pairSearchInput" oninput="filterPairs()">
                        </div>
                        <div class="dropdown-tabs">
                            <button class="dropdown-tab" onclick="setDropdownTab('favorites')">Favorites</button>
                            <button class="dropdown-tab" onclick="setDropdownTab('spot')">Spot</button>
                            <button class="dropdown-tab active" onclick="setDropdownTab('futures')">Futures</button>
                        </div>
                        <div class="dropdown-categories">
                            <button class="category-btn active">All</button>
                            <button class="category-btn">ðŸ”¥ AI</button>
                            <button class="category-btn">RWA</button>
                            <button class="category-btn">Meme</button>
                            <button class="category-btn">DeFi</button>
                            <button class="category-btn">L1</button>
                            <button class="category-btn">L2</button>
                        </div>
                        <div class="dropdown-header">
                            <span></span>
                            <span>Pair / 24H Volume</span>
                            <span>Last Price</span>
                            <span>Change</span>
                        </div>
                        <div class="dropdown-list" id="pairDropdownList">
                            <!-- Filled by JS -->
                        </div>
                    </div>
                </div>

                <button class="header-icon-btn" title="Copy">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                </button>

                <div class="header-divider"></div>

                <!-- Scrollable stats container -->
                <div class="header-stats-scroll">
                    <div class="current-price" id="currentPrice">88,500.00</div>

                    <div class="header-stat">
                        <span class="header-stat-label">24H Change</span>
                        <span class="header-stat-value negative" id="priceChange">-2.15%</span>
                    </div>

                    <div class="header-stat">
                        <span class="header-stat-label">Mark Price</span>
                        <span class="header-stat-value" id="markPrice">104,248.50</span>
                    </div>

                    <div class="header-stat">
                        <span class="header-stat-label">Index Price</span>
                        <span class="header-stat-value" id="indexPrice">104,247.00</span>
                    </div>

                    <div class="header-stat">
                        <span class="header-stat-label">24H High</span>
                        <span class="header-stat-value cyan" id="high24h">89,950.00</span>
                    </div>

                    <div class="header-stat">
                        <span class="header-stat-label">24H Low</span>
                        <span class="header-stat-value pink" id="low24h">85,300.00</span>
                    </div>

                    <div class="header-stat">
                        <span class="header-stat-label">24H Volume</span>
                        <span class="header-stat-value" id="volume24h">24.5K</span>
                    </div>

                    <div class="header-stat">
                        <span class="header-stat-label">24H Vol(USDT)</span>
                        <span class="header-stat-value" id="volumeUsdt24h">2.56B</span>
                    </div>

                    <div class="header-stat">
                        <span class="header-stat-label">Funding / Countdown</span>
                        <span class="header-stat-value positive" id="fundingRate">0.0100% / <span id="countdown">04:32:15</span></span>
                    </div>

                    <div class="live-badge">
                        <div class="live-dot"></div>
                        LIVE
                    </div>
                </div>

                <button class="alert-btn" onclick="openAlertModal()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                    Set Alert
                </button>

                <button class="header-icon-btn" title="Settings">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                </button>
            </div>

            <!-- Chart Content Area -->
            <div class="chart-content">
                <!-- TradingView Widget -->
                <div class="tradingview-widget" id="tradingview_chart">
                    <!-- TradingView Widget will be loaded here -->
                </div>

                <!-- Depth Chart -->
                <div class="depth-chart-container">
                    <div class="depth-chart-title">Depth Chart</div>
                    <canvas id="depthChart"></canvas>
                </div>

                <!-- Market Intelligence Section -->
                <div class="market-intelligence">
                    <!-- Market Heatmap -->
                    <div class="heatmap-widget">
                        <div class="widget-header">
                            <span class="widget-title">ðŸ”¥ Market Heatmap</span>
                            <span class="widget-badge live">LIVE</span>
                        </div>
                        <div class="heatmap-grid" id="heatmapGrid">
                            <!-- Filled by JS -->
                        </div>
                    </div>

                    <!-- Whale Alerts & Liquidations -->
                    <div class="whale-widget">
                        <div class="widget-header">
                            <span class="widget-title">ðŸ‹ Whale Alerts & Liquidations</span>
                            <span class="widget-badge live">LIVE</span>
                        </div>
                        <div class="whale-feed" id="whaleFeed">
                            <!-- Filled by JS -->
                        </div>
                    </div>

                    <!-- Top Gainers & Losers -->
                    <div class="gainers-widget">
                        <div class="widget-header">
                            <span class="widget-title">ðŸ“Š Top Movers</span>
                        </div>
                        <div class="movers-container">
                            <div class="movers-column gainers">
                                <div class="movers-header">ðŸš€ Gainers</div>
                                <div class="movers-list" id="gainersList">
                                    <!-- Filled by JS -->
                                </div>
                            </div>
                            <div class="movers-column losers">
                                <div class="movers-header">ðŸ’€ Losers</div>
                                <div class="movers-list" id="losersList">
                                    <!-- Filled by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Second Row: Technical Analysis, Funding, Calendar -->
                <div class="market-intelligence">
                    <!-- Technical Analysis -->
                    <div class="ta-widget">
                        <div class="widget-header">
                            <span class="widget-title">ðŸ’¹ Technical Analysis</span>
                            <span class="ta-symbol" id="taSymbol">BTC</span>
                        </div>
                        <div class="ta-content" id="taContent">
                            <div class="ta-row">
                                <span class="ta-label">RSI (14)</span>
                                <div class="ta-bar-container">
                                    <div class="ta-bar" id="taRsiBar"></div>
                                </div>
                                <span class="ta-value" id="taRsiValue">--</span>
                            </div>
                            <div class="ta-row">
                                <span class="ta-label">MACD</span>
                                <span class="ta-signal" id="taMacdSignal">--</span>
                            </div>
                            <div class="ta-row">
                                <span class="ta-label">MA 50/200</span>
                                <span class="ta-signal" id="taMaSignal">--</span>
                            </div>
                            <div class="ta-levels">
                                <div class="ta-level support">
                                    <span class="level-label">Support</span>
                                    <span class="level-value" id="taSupport">--</span>
                                </div>
                                <div class="ta-level resistance">
                                    <span class="level-label">Resistance</span>
                                    <span class="level-value" id="taResistance">--</span>
                                </div>
                            </div>
                            <div class="ta-summary" id="taSummary">
                                <span class="summary-label">Overall:</span>
                                <span class="summary-value">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Funding Rates -->
                    <div class="funding-widget">
                        <div class="widget-header">
                            <span class="widget-title">ðŸ“Š Funding Rates</span>
                            <span class="widget-badge">8h</span>
                        </div>
                        <div class="funding-list" id="fundingList">
                            <!-- Filled by JS -->
                        </div>
                        <div class="funding-footer">
                            <span class="funding-hint">ðŸŸ¢ Longs pay shorts</span>
                            <span class="funding-hint">ðŸ”´ Shorts pay longs</span>
                        </div>
                    </div>

                    <!-- Economic Calendar -->
                    <div class="calendar-widget">
                        <div class="widget-header">
                            <span class="widget-title">ðŸ“… Economic Calendar</span>
                        </div>
                        <div class="calendar-list" id="calendarList">
                            <!-- Filled by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Positions Panel -->
            <div class="positions-panel">
                <div class="positions-tabs">
                    <button class="positions-tab active">Positions(0)</button>
                    <button class="positions-tab">Open Orders(0)</button>
                    <button class="positions-tab">Order History</button>
                    <button class="positions-tab">Trade History</button>
                    <button class="positions-tab">Assets</button>
                </div>
                <div class="positions-content">
                    <span>ðŸ“‹ No open positions</span>
                </div>
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="right-sidebar">
            <!-- Order Book & Trades -->
            <div class="orderbook-trades">
                <div class="ob-tabs">
                    <button class="ob-tab active" onclick="switchObTab('orderbook')">Order Book</button>
                    <button class="ob-tab" onclick="switchObTab('trades')">Trades</button>
                </div>
                <div class="ob-content" id="orderbookContent">
                    <div class="ob-header">
                        <span>Price (USDT)</span>
                        <span>Amount (<span id="obAmountSymbol">BTC</span>)</span>
                        <span>Total</span>
                    </div>
                    <div id="asksList"></div>
                    <div class="ob-spread">
                        <div class="ob-spread-main">
                            <span class="ob-spread-price" id="spreadPrice">$88,500.00</span>
                            <span class="ob-spread-time" id="spreadTime">00:00</span>
                        </div>
                        <span class="ob-spread-label" id="spreadValue">Spread: 0.02%</span>
                    </div>
                    <div id="bidsList"></div>
                    <!-- Buy/Sell Ratio Bar -->
                    <div class="ob-ratio-bar">
                        <div class="ob-ratio-buy" id="obRatioBuy">
                            <span>B</span>
                            <span id="buyPercent">50.00%</span>
                        </div>
                        <div class="ob-ratio-sell" id="obRatioSell">
                            <span id="sellPercent">50.00%</span>
                            <span>S</span>
                        </div>
                    </div>
                </div>
                <div class="ob-content" id="tradesContent" style="display: none;">
                    <div class="ob-header">
                        <span>Price</span>
                        <span>Amount</span>
                        <span>Time</span>
                    </div>
                    <div class="trades-list" id="tradesList">
                        <!-- Filled by JS -->
                    </div>
                </div>
            </div>

            <!-- Place Trades Dropdown -->
            <div class="place-trades-section">
                <div class="place-trades-header" onclick="toggleTradeForm()">
                    <span>ðŸ“ˆ Place Trade</span>
                    <span class="place-trades-toggle" id="tradeFormToggle">â–¼</span>
                </div>
                <div class="trade-form-content" id="tradeFormContent">
                <!-- Cross/Isolated + Leverage Row -->
                <div class="trade-top-row">
                    <select class="margin-select" id="marginMode">
                        <option value="cross">Cross</option>
                        <option value="isolated">Isolated</option>
                    </select>
                    <div class="leverage-btn" id="leverageBtn" onclick="openLeverageModal()">
                        <span id="leverageDisplay">20X</span>
                    </div>
                </div>

                <!-- Open/Close Tabs -->
                <div class="oc-tabs">
                    <button class="oc-tab active" onclick="setOcTab(this, 'open')">Open</button>
                    <button class="oc-tab" onclick="setOcTab(this, 'close')">Close</button>
                </div>

                <!-- Order Types -->
                <div class="order-types-row">
                    <button class="ot-btn active" onclick="setOtBtn(this)">Limit</button>
                    <button class="ot-btn" onclick="setOtBtn(this)">Market</button>
                    <button class="ot-btn" onclick="setOtBtn(this)">Trigger â–¾</button>
                </div>

                <!-- Available -->
                <div class="avail-row">
                    <span>Available</span>
                    <span id="availBalance">0.0000 USDT</span>
                </div>

                <!-- Order Price -->
                <div class="input-row">
                    <label>Order Price</label>
                    <div class="input-box">
                        <input type="text" id="priceInput" value="86,802.9">
                        <button class="last-btn" onclick="setLastPrice()">Last</button>
                        <span class="currency">USDT</span>
                        <div class="spinners">
                            <button onclick="adjustPrice(1)">+</button>
                            <button onclick="adjustPrice(-1)">âˆ’</button>
                        </div>
                    </div>
                </div>

                <!-- Quantity -->
                <div class="input-row">
                    <label>Quantity</label>
                    <div class="input-box">
                        <input type="text" id="amountInput" placeholder="0" value="">
                        <select class="qty-select" id="qtyAsset">
                            <option value="BTC">BTC â–¾</option>
                            <option value="USDT">USDT</option>
                        </select>
                    </div>
                </div>

                <!-- Percent Slider -->
                <div class="slider-row">
                    <input type="range" class="pct-slider" id="pctSlider" min="0" max="100" value="0" oninput="setPctSlider(this.value)">
                    <div class="pct-marks">
                        <span onclick="setPct(0)">0%</span>
                        <span onclick="setPct(25)">25%</span>
                        <span onclick="setPct(50)">50%</span>
                        <span onclick="setPct(75)">75%</span>
                        <span onclick="setPct(100)">100%</span>
                    </div>
                </div>

                <!-- TP/SL -->
                <div class="tpsl-section">
                    <div class="tpsl-header">
                        <label class="tpsl-check">
                            <input type="checkbox" id="tpslEnabled" checked onchange="toggleTpsl()">
                            <span class="cmark"></span>
                            TP / SL
                        </label>
                        <span class="advanced-btn">Advanced â–¶</span>
                    </div>
                    <div class="tpsl-inputs" id="tpslInputs">
                        <div class="tpsl-input-row">
                            <span class="tpsl-label">TP</span>
                            <input type="text" class="tpsl-input" placeholder="" id="tpInput">
                            <select class="tpsl-type">
                                <option>Price (USDT) â–¾</option>
                                <option>ROI %</option>
                            </select>
                        </div>
                        <div class="tpsl-input-row">
                            <span class="tpsl-label">SL</span>
                            <input type="text" class="tpsl-input" placeholder="" id="slInput">
                            <select class="tpsl-type">
                                <option>Price (USDT) â–¾</option>
                                <option>ROI %</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Long/Short Buttons -->
                <div class="ls-btns">
                    <button class="long-btn" onclick="openPosition('long')">Open long</button>
                    <button class="short-btn" onclick="openPosition('short')">Open short</button>
                </div>

                <!-- Cost Info -->
                <div class="cost-row">
                    <div class="cost-left">
                        <div><span class="cost-label">Cost</span></div>
                        <div><span id="longCost">0.0 USDT</span></div>
                        <div><span class="cost-label">Max</span></div>
                        <div><span id="longMax">0.0 BTC</span></div>
                    </div>
                    <div class="cost-right">
                        <div><span class="cost-label">Cost</span></div>
                        <div><span id="shortCost">0.0 USDT</span></div>
                        <div><span class="cost-label">Max</span></div>
                        <div><span id="shortMax">0.0 BTC</span></div>
                    </div>
                </div>

                <!-- Effective Time -->
                <div class="eff-row">
                    <span>Effective Time</span>
                    <select id="effTime">
                        <option>GTC â–¾</option>
                        <option>IOC</option>
                        <option>FOK</option>
                    </select>
                </div>

                <!-- VIP Info -->
                <div class="vip-row">
                    <span class="vip-icon">ðŸ›¡ï¸</span>
                    <div class="vip-info">
                        <span class="vip-level">VIP 0</span>
                        <span class="vip-fees">Maker 0.0300%    Taker 0.0600%</span>
                    </div>
                </div>

                <!-- Margin Info -->
                <div class="margin-box">
                    <div class="margin-title">Margin</div>
                    <div class="margin-row"><span>USDT Â· Cross</span></div>
                    <div class="margin-row"><span>Margin Rate</span><span class="safe">ðŸŸ¡ 0.0%</span></div>
                </div>
                </div>
            </div>

            <!-- Widgets Section -->
            <div class="widgets-section">
                <!-- Fear & Greed -->
                <div class="fear-greed">
                    <div class="fg-header">
                        <span class="fg-title">Fear & Greed Index <span id="fgClassification" style="font-size: 10px; opacity: 0.7;"></span></span>
                        <span class="fg-value" id="fgValue" style="color: var(--cyan);">...</span>
                    </div>
                    <div class="fg-gauge">
                        <div class="fg-needle" id="fgNeedle" style="left: 50%;"></div>
                    </div>
                    <div class="fg-labels">
                        <span>Extreme Fear</span>
                        <span>Neutral</span>
                        <span>Extreme Greed</span>
                    </div>
                    <div id="fgSource" style="font-size: 9px; color: var(--text-muted); text-align: center; margin-top: 8px;">Loading...</div>
                </div>

                <!-- Portfolio -->
                <div class="portfolio-widget">
                    <div class="portfolio-header">
                        <span class="portfolio-title">Portfolio</span>
                        <span class="portfolio-total">$12,450.00</span>
                    </div>
                    <div class="portfolio-chart">
                        <canvas id="portfolioChart"></canvas>
                        <div class="portfolio-legend" id="portfolioLegend">
                            <!-- Filled by JS -->
                        </div>
                    </div>
                </div>

                <!-- News Feed -->
                <div class="news-widget">
                    <div class="news-title">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                        </svg>
                        Latest News
                    </div>
                    <div id="newsFeed">
                        <!-- Filled by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Quick Trade Button -->
    <div class="quick-trade-fab" id="quickTradeFab" onclick="openQuickTrade()">
        <span class="fab-icon">âš¡</span>
        <span class="fab-text">Trade</span>
        <div class="fab-hint">Press T</div>
    </div>

    <!-- Keyboard Shortcuts Hint -->
    <div class="shortcuts-hint" id="shortcutsHint">
        <span>âŒ¨ï¸ Shortcuts: <b>T</b> Trade â€¢ <b>B</b> Buy â€¢ <b>S</b> Sell â€¢ <b>Esc</b> Close</span>
    </div>

    <!-- Quick Trade Modal -->
    <div class="modal-overlay" id="quickTradeModal">
        <div class="quick-trade-modal">
            <div class="qtm-header">
                <div class="qtm-pair">
                    <span class="qtm-symbol" id="qtmSymbol">BTC/USDT</span>
                    <span class="qtm-price" id="qtmPrice">$87,500.00</span>
                </div>
                <button class="qtm-close" onclick="closeQuickTrade()">âœ•</button>
            </div>
            
            <div class="qtm-mini-book">
                <div class="qtm-asks" id="qtmAsks">
                    <div class="qtm-row ask"><span>87,502.1</span><span>0.523</span></div>
                    <div class="qtm-row ask"><span>87,501.5</span><span>0.891</span></div>
                    <div class="qtm-row ask"><span>87,500.8</span><span>1.204</span></div>
                </div>
                <div class="qtm-spread">Spread: 0.01%</div>
                <div class="qtm-bids" id="qtmBids">
                    <div class="qtm-row bid"><span>87,499.2</span><span>0.756</span></div>
                    <div class="qtm-row bid"><span>87,498.8</span><span>1.102</span></div>
                    <div class="qtm-row bid"><span>87,498.1</span><span>0.445</span></div>
                </div>
            </div>

            <div class="qtm-form">
                <div class="qtm-leverage">
                    <span>Leverage</span>
                    <div class="qtm-lev-btns">
                        <button onclick="setQtmLev(5)">5x</button>
                        <button onclick="setQtmLev(10)">10x</button>
                        <button class="active" onclick="setQtmLev(20)">20x</button>
                        <button onclick="setQtmLev(50)">50x</button>
                        <button onclick="setQtmLev(100)">100x</button>
                    </div>
                </div>
                
                <div class="qtm-amount">
                    <label>Amount (USDT)</label>
                    <div class="qtm-amount-row">
                        <input type="text" id="qtmAmount" value="100" placeholder="0">
                        <div class="qtm-quick-amounts">
                            <button onclick="setQtmAmount(100)">$100</button>
                            <button onclick="setQtmAmount(500)">$500</button>
                            <button onclick="setQtmAmount(1000)">$1K</button>
                        </div>
                    </div>
                </div>

                <!-- TP/SL Section -->
                <div class="qtm-tpsl">
                    <div class="qtm-tpsl-header">
                        <label class="qtm-tpsl-toggle">
                            <input type="checkbox" id="qtmTpslEnabled" checked onchange="toggleQtmTpsl()">
                            <span class="qtm-checkmark"></span>
                            TP / SL
                        </label>
                    </div>
                    <div class="qtm-tpsl-inputs" id="qtmTpslInputs">
                        <div class="qtm-tpsl-row">
                            <span class="qtm-tpsl-label tp">TP</span>
                            <input type="text" id="qtmTp" placeholder="Price">
                            <div class="qtm-quick-pct">
                                <button onclick="setQtmTpPct(1)">+1%</button>
                                <button onclick="setQtmTpPct(2)">+2%</button>
                                <button onclick="setQtmTpPct(5)">+5%</button>
                            </div>
                            <span class="qtm-tpsl-pct" id="qtmTpPct">+0%</span>
                        </div>
                        <div class="qtm-tpsl-row">
                            <span class="qtm-tpsl-label sl">SL</span>
                            <input type="text" id="qtmSl" placeholder="Price">
                            <div class="qtm-quick-pct">
                                <button onclick="setQtmSlPct(1)">-1%</button>
                                <button onclick="setQtmSlPct(2)">-2%</button>
                                <button onclick="setQtmSlPct(5)">-5%</button>
                            </div>
                            <span class="qtm-tpsl-pct" id="qtmSlPct">-0%</span>
                        </div>
                    </div>
                </div>

                <div class="qtm-buttons">
                    <button class="qtm-long" onclick="executeQuickTrade('long')">
                        <span class="qtm-btn-label">LONG</span>
                        <span class="qtm-btn-hint">[B]</span>
                    </button>
                    <button class="qtm-short" onclick="executeQuickTrade('short')">
                        <span class="qtm-btn-label">SHORT</span>
                        <span class="qtm-btn-hint">[S]</span>
                    </button>
                </div>
                
                <div class="qtm-info">
                    <span>Est. Liquidation: <b id="qtmLiq">$82,150</b></span>
                    <span>Fee: <b>0.06%</b></span>
                </div>
                <div class="qtm-shortcuts">
                    âŒ¨ï¸ <span>B</span> Long â€¢ <span>S</span> Short â€¢ <span>Esc</span> Close
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer-brand">Powered by Mariahâ„¢</div>

    <!-- Wallet Modal -->
    <div class="modal-overlay" id="walletModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">Connect Wallet</span>
                <button class="modal-close" onclick="closeWalletModal()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="wallet-options">
                <div class="wallet-option" onclick="connectWallet('metamask')">
                    <div class="wallet-option-icon" style="background: #f6851b;">ðŸ¦Š</div>
                    <div>
                        <div class="wallet-option-name">MetaMask</div>
                        <div class="wallet-option-desc">Connect using browser wallet</div>
                    </div>
                </div>
                <div class="wallet-option" onclick="connectWallet('walletconnect')">
                    <div class="wallet-option-icon" style="background: #3b99fc;">ðŸ”—</div>
                    <div>
                        <div class="wallet-option-name">WalletConnect</div>
                        <div class="wallet-option-desc">Scan with mobile wallet</div>
                    </div>
                </div>
                <div class="wallet-option" onclick="connectWallet('coinbase')">
                    <div class="wallet-option-icon" style="background: #0052ff;">ðŸ’°</div>
                    <div>
                        <div class="wallet-option-name">Coinbase Wallet</div>
                        <div class="wallet-option-desc">Connect using Coinbase</div>
                    </div>
                </div>
                <div class="wallet-option" onclick="connectWallet('phantom')">
                    <div class="wallet-option-icon" style="background: #ab9ff2;">ðŸ‘»</div>
                    <div>
                        <div class="wallet-option-name">Phantom</div>
                        <div class="wallet-option-desc">Connect Solana wallet</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Confirmation Modal -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">Confirm Order</span>
                <button class="modal-close" onclick="closeConfirmModal()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="confirm-details">
                <div class="confirm-row">
                    <span class="confirm-label">Type</span>
                    <span class="confirm-value" id="confirmType">BUY</span>
                </div>
                <div class="confirm-row">
                    <span class="confirm-label">Pair</span>
                    <span class="confirm-value">MX1/USDT</span>
                </div>
                <div class="confirm-row">
                    <span class="confirm-label">Price</span>
                    <span class="confirm-value" id="confirmPrice">2.3845 USDT</span>
                </div>
                <div class="confirm-row">
                    <span class="confirm-label">Amount</span>
                    <span class="confirm-value" id="confirmAmount">0.00 MX1</span>
                </div>
                <div class="confirm-row">
                    <span class="confirm-label">Leverage</span>
                    <span class="confirm-value" id="confirmLeverage">10x</span>
                </div>
                <div class="confirm-row">
                    <span class="confirm-label">Total</span>
                    <span class="confirm-value" id="confirmTotal">0.00 USDT</span>
                </div>
            </div>
            <div class="confirm-btns">
                <button class="confirm-cancel" onclick="closeConfirmModal()">Cancel</button>
                <button class="confirm-submit" onclick="executeOrder()">Confirm Order</button>
            </div>
        </div>
    </div>

    <!-- Price Alert Modal -->
    <div class="modal-overlay" id="alertModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">Set Price Alert</span>
                <button class="modal-close" onclick="closeAlertModal()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="alert-types">
                <button class="alert-type-btn active">Above</button>
                <button class="alert-type-btn">Below</button>
                <button class="alert-type-btn">% Change</button>
            </div>
            <div class="alert-input-group">
                <div class="alert-input-label">Alert Price (USDT)</div>
                <div class="input-group">
                    <input type="text" value="2.50" id="alertPrice">
                    <div class="input-suffix">USDT</div>
                </div>
            </div>
            <button class="alert-save-btn" onclick="saveAlert()">Create Alert</button>
        </div>
    </div>

    <!-- AI Chat Bubble -->
    <div class="ai-chat-bubble" id="aiChat">
        <div class="ai-chat-window">
            <div class="ai-chat-header">
                <div class="ai-avatar">M</div>
                <div class="ai-info">
                    <h4>Mariah AI</h4>
                    <span>Trading Assistant</span>
                </div>
            </div>
            <div class="ai-chat-messages" id="aiMessages">
                <div class="ai-message bot">
                    ðŸ‘‹ Hi! I'm Mariah, your AI trading assistant. I can help you with market analysis, trading strategies, and answer questions about MX1 Exchange. How can I help you today?
                </div>
            </div>
            <div class="ai-chat-input">
                <input type="text" placeholder="Ask Mariah anything..." id="aiInput" onkeypress="if(event.key==='Enter')sendAiMessage()">
                <button onclick="sendAiMessage()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"></path>
                    </svg>
                </button>
            </div>
        </div>
        <button class="ai-chat-btn" onclick="toggleAiChat()">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
        </button>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Keyboard Shortcuts Hint -->
    <div class="shortcuts-hint">
        <div class="shortcut-key"><kbd>B</kbd> Buy</div>
        <div class="shortcut-key"><kbd>S</kbd> Sell</div>
        <div class="shortcut-key"><kbd>Esc</kbd> Close</div>
    </div>

    <!-- Sound Effects (Base64 encoded short sounds) -->
    <audio id="successSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdH2Onp6WgG9tf4GDhod/d3R5gIeNjoqDenZ4fIGGiYmGgHt5fICFh4eFgX16eoGIioeAfHt9gYaIh4R/fHx/hIeGhYJ/fn2AhIaFg4F/foCAgoOCgYB/f4CBgoGAgH9/f4CAgIB/f39/f4CAgIB/f39/gICAgH9/f3+AgICAgH9/f39/gICAf39/f39/gIB/f39/f39/f39/f39/f39/f39/fw==" type="audio/wav">
    </audio>

    <script>
        /*
         * MX1 EXCHANGE - Professional Crypto Trading Interface
         * =====================================================
         * 
         * LIVE DATA SOURCES:
         * - Binance WebSocket: Real-time prices, order book, trades
         * - TradingView: Professional charting
         * - Alternative.me: Fear & Greed Index
         * - CryptoCompare: Social sentiment data
         * 
         * FEATURES:
         * - Real-time price updates via WebSocket
         * - Live order book with depth visualization
         * - Streaming trades feed
         * - Interactive TradingView charts
         * - Social sentiment analysis
         * - Fear & Greed Index
         * - AI Trading Assistant (Mariah)
         * - Portfolio tracking
         * - Price alerts
         * - Mobile responsive
         * 
         * FALLBACK:
         * - Simulation mode activates if APIs unavailable
         */

        // ===== GLOBAL STATE =====
        let tradeType = 'buy';
        let leverage = 10;
        let isDarkTheme = true;
        let soundEnabled = true;

        // ===== LIVE TICKER DATA =====
        const tickerSymbols = ['BTCUSDT', 'ETHUSDT', 'SOLUSDT', 'XRPUSDT', 'DOGEUSDT', 'ADAUSDT', 'AVAXUSDT', 'LINKUSDT', 'DOTUSDT', 'MATICUSDT'];
        let liveTickerData = {};
        let tickerWs = null;

        // Initial mock data (replaced by live data)
        const tickerData = [
            { symbol: 'MX1', price: 2.385, change: 8.42 },
            { symbol: 'BTC', price: 88500, change: -2.15 },
            { symbol: 'ETH', price: 3142.50, change: -1.23 },
            { symbol: 'SOL', price: 218.80, change: -3.67 },
            { symbol: 'XRP', price: 2.38, change: -0.89 },
            { symbol: 'DOGE', price: 0.395, change: -2.21 },
            { symbol: 'ADA', price: 1.05, change: -1.45 },
            { symbol: 'AVAX', price: 42.60, change: -2.34 },
            { symbol: 'LINK', price: 26.90, change: -1.56 },
            { symbol: 'DOT', price: 7.85, change: -0.78 }
        ];

        function initTicker() {
            const ticker = document.getElementById('ticker');
            const items = tickerData.map(t => `
                <div class="ticker-item" data-symbol="${t.symbol}">
                    <span class="ticker-symbol">${t.symbol}/USDT</span>
                    <span class="ticker-price" id="ticker-price-${t.symbol}">$${t.price.toLocaleString()}</span>
                    <span class="ticker-change ${t.change >= 0 ? 'positive' : 'negative'}" id="ticker-change-${t.symbol}">
                        ${t.change >= 0 ? '+' : ''}${t.change}%
                    </span>
                </div>
            `).join('');
            ticker.innerHTML = items + items; // Duplicate for seamless loop
            
            // Connect to live ticker WebSocket
            connectTickerWebSocket();
        }

        function connectTickerWebSocket() {
            const streams = tickerSymbols.map(s => `${s.toLowerCase()}@ticker`).join('/');
            tickerWs = new WebSocket(`wss://stream.binance.com:9443/stream?streams=${streams}`);
            
            tickerWs.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (data.data) {
                    const ticker = data.data;
                    const symbol = ticker.s.replace('USDT', '');
                    const price = parseFloat(ticker.c);
                    const change = parseFloat(ticker.P);
                    
                    // Update all instances of this ticker (duplicated for loop)
                    document.querySelectorAll(`#ticker-price-${symbol}`).forEach(el => {
                        if (el) {
                            const oldPrice = parseFloat(el.textContent.replace(/[$,]/g, ''));
                            el.textContent = price > 100 ? `$${price.toLocaleString(undefined, {maximumFractionDigits: 2})}` : `$${price.toFixed(4)}`;
                            
                            // Flash effect
                            el.style.color = price > oldPrice ? '#00d4ff' : '#ff1493';
                            setTimeout(() => el.style.color = '', 300);
                        }
                    });
                    
                    document.querySelectorAll(`#ticker-change-${symbol}`).forEach(el => {
                        if (el) {
                            el.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
                            el.className = `ticker-change ${change >= 0 ? 'positive' : 'negative'}`;
                        }
                    });
                    
                    // Store live data for dropdown
                    liveTickerData[symbol] = { price, change };
                    
                    // Update dropdown if it's open
                    updateDropdownPrices();
                }
            };
            
            tickerWs.onerror = () => {};
            tickerWs.onclose = () => setTimeout(connectTickerWebSocket, 5000);
        }

        function updateDropdownPrices() {
            Object.entries(liveTickerData).forEach(([symbol, data]) => {
                const priceEl = document.querySelector(`.dropdown-item[data-symbol="${symbol}"] .dropdown-item-price`);
                const changeEl = document.querySelector(`.dropdown-item[data-symbol="${symbol}"] .dropdown-item-change`);
                
                if (priceEl) {
                    priceEl.textContent = data.price > 100 ? `$${data.price.toLocaleString(undefined, {maximumFractionDigits: 2})}` : `$${data.price.toFixed(4)}`;
                }
                if (changeEl) {
                    changeEl.textContent = `${data.change >= 0 ? '+' : ''}${data.change.toFixed(2)}%`;
                    changeEl.className = `dropdown-item-change ${data.change >= 0 ? 'positive' : 'negative'}`;
                }
            });
        }

        // ===== MARKET DROPDOWN =====
        let favorites = new Set(['MX1', 'BTC', 'ETH']);
        let selectedPairData = tickerData[1]; // Start with BTC for live data

        function initPairDropdown() {
            renderDropdownList(tickerData);
        }

        function renderDropdownList(data) {
            const list = document.getElementById('pairDropdownList');
            list.innerHTML = data.map((m, i) => {
                const liveData = liveTickerData[m.symbol] || { price: m.price, change: m.change };
                const priceDisplay = liveData.price > 100 ? 
                    liveData.price.toLocaleString(undefined, {maximumFractionDigits: 2}) : 
                    liveData.price.toFixed(4);
                
                return `
                <div class="dropdown-item ${m.symbol === selectedPairData.symbol ? 'active' : ''}" data-symbol="${m.symbol}" onclick="selectPair('${m.symbol}')">
                    <span class="dropdown-item-star ${favorites.has(m.symbol) ? 'favorited' : ''}" onclick="event.stopPropagation(); toggleFavorite('${m.symbol}')">
                        ${favorites.has(m.symbol) ? 'â˜…' : 'â˜†'}
                    </span>
                    <div class="dropdown-item-info">
                        <div class="dropdown-item-icon">${m.symbol.slice(0, 3)}</div>
                        <div>
                            <div class="dropdown-item-name">${m.symbol}USDT</div>
                            <div class="dropdown-item-volume">${(Math.random() * 2 + 0.5).toFixed(2)}B</div>
                        </div>
                    </div>
                    <div class="dropdown-item-price">$${priceDisplay}</div>
                    <div class="dropdown-item-change ${liveData.change >= 0 ? 'positive' : 'negative'}">
                        ${liveData.change >= 0 ? '+' : ''}${liveData.change.toFixed(2)}%
                    </div>
                </div>
            `}).join('');
        }

        function togglePairDropdown() {
            const selector = document.getElementById('pairSelector');
            selector.classList.toggle('open');
            // Refresh dropdown with latest live data
            if (selector.classList.contains('open')) {
                renderDropdownList(tickerData);
            }
        }

        function selectPair(symbol) {
            selectedPairData = tickerData.find(t => t.symbol === symbol) || tickerData[0];
            const liveData = liveTickerData[symbol] || selectedPairData;
            
            const priceDisplay = liveData.price > 100 ? 
                liveData.price.toLocaleString(undefined, {maximumFractionDigits: 2}) : 
                liveData.price.toFixed(4);
            
            // Update header
            document.getElementById('selectedPair').textContent = symbol + 'USDT';
            document.getElementById('pairIcon').textContent = symbol.slice(0, 3);
            document.getElementById('currentPrice').textContent = priceDisplay;
            
            const changeEl = document.getElementById('priceChange');
            changeEl.textContent = (liveData.change >= 0 ? '+' : '') + liveData.change.toFixed(2) + '%';
            changeEl.className = 'header-stat-value ' + (liveData.change >= 0 ? 'positive' : 'negative');
            
            // Update order book header
            document.getElementById('obAmountSymbol').textContent = symbol;
            document.getElementById('spreadPrice').textContent = '$' + priceDisplay;
            
            // Update trade form
            document.getElementById('priceInput').value = priceDisplay;
            document.getElementById('priceApprox').textContent = 'â‰ˆ $' + priceDisplay;
            document.getElementById('amountSuffix').textContent = symbol;
            
            // Update submit button
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.textContent = (tradeType === 'buy' ? 'BUY ' : 'SELL ') + symbol;
            
            // Update social sentiment for this pair
            if (symbol !== 'MX1') {
                fetchRealSentiment(symbol).then(() => updateSentiment(symbol));
            } else {
                updateSentiment(symbol);
            }
            
            // Update technical analysis for this pair
            currentTaSymbol = symbol;
            if (typeof updateTechnicalAnalysis === 'function') {
                updateTechnicalAnalysis();
            }
            
            // Clear trades list for fresh live data
            document.getElementById('tradesList').innerHTML = `
                <div style="text-align: center; color: var(--text-muted); padding: 20px; font-size: 12px;">
                    <div style="margin-bottom: 8px;">â³ Connecting to ${symbol} feed...</div>
                </div>
            `;
            
            document.getElementById('pairSelector').classList.remove('open');
            renderDropdownList(tickerData);
            
            // Switch to new symbol's live data
            if (symbol !== 'MX1') {
                currentSymbol = symbol + 'USDT';
                
                // Stop existing polling/simulation
                if (pollingInterval) {
                    clearInterval(pollingInterval);
                    pollingInterval = null;
                }
                if (simulationInterval) {
                    clearInterval(simulationInterval);
                    simulationInterval = null;
                }
                
                // If we were in simulation mode, restart it for new pair
                if (simulationMode) {
                    simulationMode = false;
                    setTimeout(() => startSimulation(), 100);
                } else {
                    // Try to fetch real data
                    fetchLiveData();
                    connectBinanceWebSocket();
                    
                    // Fall back to simulation if needed
                    setTimeout(() => {
                        if (!wsConnected && !simulationMode) {
                            startSimulation();
                        }
                    }, 2000);
                }
                
                showToast('success', 'Pair Changed', `${symbol}/USDT`);
            } else {
                showToast('success', 'Pair Changed', `${symbol}/USDT (Demo Mode)`);
            }
        }

        function toggleFavorite(symbol) {
            if (favorites.has(symbol)) {
                favorites.delete(symbol);
            } else {
                favorites.add(symbol);
            }
            renderDropdownList(tickerData);
        }

        function filterPairs() {
            const query = document.getElementById('pairSearchInput').value.toLowerCase();
            const filtered = tickerData.filter(m => 
                m.symbol.toLowerCase().includes(query)
            );
            renderDropdownList(filtered);
        }

        function setDropdownTab(tab) {
            document.querySelectorAll('.dropdown-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            // Filter based on tab (for demo, just show all)
            if (tab === 'favorites') {
                const favData = tickerData.filter(m => favorites.has(m.symbol));
                renderDropdownList(favData);
            } else {
                renderDropdownList(tickerData);
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const selector = document.getElementById('pairSelector');
            if (selector && !selector.contains(e.target)) {
                selector.classList.remove('open');
            }
        });

        // ===== LIVE DATA STATE =====
        let liveOrderBook = { bids: [], asks: [] };
        let liveTrades = [];
        let currentSymbol = 'BTCUSDT';
        let ws = null;
        let lastPrice = 0;

        // ===== BINANCE WEBSOCKET =====
        let wsConnected = false;
        let pollingInterval = null;
        
        function connectBinanceWebSocket() {
            // Close existing connection
            if (ws) ws.close();
            
            const symbol = currentSymbol.toLowerCase();
            
            try {
                // Connect to Binance WebSocket for order book, trades, and ticker
                ws = new WebSocket(`wss://stream.binance.com:9443/stream?streams=${symbol}@depth20@100ms/${symbol}@trade/${symbol}@ticker`);
                
                ws.onopen = () => {
                    
                    showToast('success', 'Live Data', `Connected to ${currentSymbol} stream`);
                    wsConnected = true;
                    // Stop polling if we have WebSocket
                    if (pollingInterval) {
                        clearInterval(pollingInterval);
                        pollingInterval = null;
                    }
                };
                
                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    
                    if (data.stream && data.stream.includes('@depth')) {
                        // Order book update
                        liveOrderBook = {
                            bids: data.data.bids.slice(0, 8).map(([price, amount]) => ({
                                price: parseFloat(price),
                                amount: parseFloat(amount)
                            })),
                            asks: data.data.asks.slice(0, 8).map(([price, amount]) => ({
                                price: parseFloat(price),
                                amount: parseFloat(amount)
                            }))
                        };
                        renderLiveOrderBook();
                        drawLiveDepthChart();
                    }
                    
                    if (data.stream && data.stream.includes('@trade')) {
                        // New trade - update header price
                        const trade = data.data;
                        const price = parseFloat(trade.p);
                        
                        updateHeaderPrice(price);
                        
                        addLiveTrade({
                            price: price,
                            amount: parseFloat(trade.q),
                            isBuy: !trade.m,
                            time: new Date(trade.T).toLocaleTimeString()
                        });
                    }
                    
                    if (data.stream && data.stream.includes('@ticker')) {
                        // 24h ticker update - update header stats
                        const ticker = data.data;
                        updateHeaderStats({
                            price: parseFloat(ticker.c),
                            change: parseFloat(ticker.P),
                            high: parseFloat(ticker.h),
                            low: parseFloat(ticker.l),
                            volume: parseFloat(ticker.v),
                            quoteVolume: parseFloat(ticker.q)
                        });
                    }
                };
                
                ws.onerror = (error) => {
                    
                    wsConnected = false;
                    startPolling();
                };
                
                ws.onclose = () => {
                    
                    wsConnected = false;
                    // Start polling as backup
                    startPolling();
                    // Try to reconnect WebSocket after 5s
                    setTimeout(connectBinanceWebSocket, 5000);
                };
            } catch (e) {
                
                startPolling();
            }
        }

        // REST API Polling (fallback when WebSocket fails)
        let simulationMode = false;
        let simulationInterval = null;
        
        function startPolling() {
            if (pollingInterval) return; // Already polling
            
            
            
            // Poll immediately
            fetchLiveData();
            
            // Then poll every 2 seconds
            pollingInterval = setInterval(fetchLiveData, 2000);
        }

        async function fetchLiveData() {
            try {
                // Fetch ticker data
                const tickerRes = await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${currentSymbol}`);
                
                if (!tickerRes.ok) throw new Error('API not available');
                
                const ticker = await tickerRes.json();
                
                if (ticker && ticker.lastPrice) {
                    const price = parseFloat(ticker.lastPrice);
                    updateHeaderPrice(price);
                    updateHeaderStats({
                        price: price,
                        change: parseFloat(ticker.priceChangePercent),
                        high: parseFloat(ticker.highPrice),
                        low: parseFloat(ticker.lowPrice),
                        volume: parseFloat(ticker.volume),
                        quoteVolume: parseFloat(ticker.quoteVolume)
                    });
                }
                
                // Fetch order book
                const depthRes = await fetch(`https://api.binance.com/api/v3/depth?symbol=${currentSymbol}&limit=10`);
                const depth = await depthRes.json();
                
                if (depth && depth.bids && depth.asks) {
                    liveOrderBook = {
                        bids: depth.bids.slice(0, 8).map(([price, amount]) => ({
                            price: parseFloat(price),
                            amount: parseFloat(amount)
                        })),
                        asks: depth.asks.slice(0, 8).map(([price, amount]) => ({
                            price: parseFloat(price),
                            amount: parseFloat(amount)
                        }))
                    };
                    renderLiveOrderBook();
                    drawLiveDepthChart();
                }
                
                // Fetch recent trades
                const tradesRes = await fetch(`https://api.binance.com/api/v3/trades?symbol=${currentSymbol}&limit=5`);
                const trades = await tradesRes.json();
                
                if (trades && trades.length > 0) {
                    const latestTrade = trades[trades.length - 1];
                    addLiveTrade({
                        price: parseFloat(latestTrade.price),
                        amount: parseFloat(latestTrade.qty),
                        isBuy: latestTrade.isBuyerMaker === false,
                        time: new Date(latestTrade.time).toLocaleTimeString()
                    });
                }
                
            } catch (e) {
                
                if (!simulationMode) {
                    startSimulation();
                }
            }
        }

        // ===== SIMULATION MODE =====
        // When APIs are blocked, simulate realistic live data
        function startSimulation() {
            if (simulationMode) return;
            simulationMode = true;
            
            
            showToast('info', 'Demo Mode', 'Showing simulated live data');
            
            // Stop polling
            if (pollingInterval) {
                clearInterval(pollingInterval);
                pollingInterval = null;
            }
            
            // Get base price for current symbol
            const basePrices = {
                BTCUSDT: 88500,
                ETHUSDT: 3142,
                SOLUSDT: 218,
                XRPUSDT: 2.38,
                DOGEUSDT: 0.395,
                ADAUSDT: 1.05,
                AVAXUSDT: 42.60,
                LINKUSDT: 26.90,
                DOTUSDT: 7.85,
                MATICUSDT: 0.58
            };
            
            let simPrice = basePrices[currentSymbol] || 100;
            let simChange = -2.15;
            
            // Generate initial order book
            generateSimulatedOrderBook(simPrice);
            
            // Generate initial trades
            generateSimulatedTrades(simPrice);
            
            // Update price every 1 second - comfortable to watch
            simulationInterval = setInterval(() => {
                // Random price movement (-0.02% to +0.02%)
                const movement = (Math.random() - 0.48) * simPrice * 0.0004;
                simPrice += movement;
                
                // Update header price with flash
                updateHeaderPrice(simPrice);
                
            }, 1000);
            
            // Update order book every 500ms
            setInterval(() => {
                if (!simulationMode) return;
                generateSimulatedOrderBook(simPrice);
            }, 500);
            
            // Add trades every 1-3 seconds randomly
            function addRandomTrade() {
                if (!simulationMode) return;
                
                addLiveTrade({
                    price: simPrice + (Math.random() - 0.5) * simPrice * 0.0002,
                    amount: Math.random() * (simPrice > 100 ? 0.5 : 1000) + 0.001,
                    isBuy: Math.random() > 0.48,
                    time: new Date().toLocaleTimeString()
                });
                
                // Schedule next trade (1-3 seconds randomly)
                setTimeout(addRandomTrade, Math.random() * 2000 + 1000);
            }
            addRandomTrade();
            
            // Update stats every 2 seconds
            setInterval(() => {
                if (!simulationMode) return;
                updateHeaderStats({
                    price: simPrice,
                    change: simChange + (Math.random() - 0.5) * 0.1,
                    high: simPrice * 1.02,
                    low: simPrice * 0.97,
                    volume: Math.random() * 50000 + 10000,
                    quoteVolume: Math.random() * 5000000000 + 1000000000
                });
            }, 2000);
        }

        function generateSimulatedOrderBook(basePrice) {
            const asks = [];
            const bids = [];
            
            for (let i = 0; i < 8; i++) {
                const spread = basePrice * 0.00005 * (i + 1);
                
                // Use existing amounts if available, with small random changes
                const existingAsk = liveOrderBook.asks[i];
                const existingBid = liveOrderBook.bids[i];
                
                const baseAskAmount = existingAsk ? existingAsk.amount : Math.random() * (basePrice > 100 ? 2 : 5000) + 0.1;
                const baseBidAmount = existingBid ? existingBid.amount : Math.random() * (basePrice > 100 ? 2 : 5000) + 0.1;
                
                // Small random change to amounts (-5% to +5%)
                const askAmountChange = baseAskAmount * (Math.random() - 0.5) * 0.1;
                const bidAmountChange = baseBidAmount * (Math.random() - 0.5) * 0.1;
                
                asks.push({
                    price: basePrice + spread,
                    amount: Math.max(0.001, baseAskAmount + askAmountChange)
                });
                bids.push({
                    price: basePrice - spread,
                    amount: Math.max(0.001, baseBidAmount + bidAmountChange)
                });
            }
            
            liveOrderBook = { bids, asks };
            renderLiveOrderBook();
            drawLiveDepthChart();
        }

        function generateSimulatedTrades(basePrice) {
            const list = document.getElementById('tradesList');
            if (!list) return;
            list.innerHTML = '';
            
            for (let i = 0; i < 15; i++) {
                const trade = {
                    price: basePrice + (Math.random() - 0.5) * basePrice * 0.001,
                    amount: Math.random() * (basePrice > 100 ? 0.5 : 1000) + 0.01,
                    isBuy: Math.random() > 0.5,
                    time: new Date(Date.now() - i * 2000).toLocaleTimeString()
                };
                
                const row = document.createElement('div');
                row.className = `trade-row ${trade.isBuy ? 'buy' : 'sell'}`;
                
                const formatPrice = (p) => p > 100 ? p.toLocaleString(undefined, {maximumFractionDigits: 2}) : p.toFixed(4);
                const formatAmount = (a) => a > 1 ? a.toFixed(4) : a.toFixed(6);
                
                row.innerHTML = `
                    <span class="trade-price">${formatPrice(trade.price)}</span>
                    <span class="trade-amount">${formatAmount(trade.amount)}</span>
                    <span class="trade-time">${trade.time}</span>
                `;
                
                list.appendChild(row);
            }
        }

        function stopSimulation() {
            simulationMode = false;
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
            }
        }

        function updateHeaderPrice(price) {
            const priceEl = document.getElementById('currentPrice');
            if (!priceEl) return;
            
            // Format price
            const formatPrice = price > 100 ? 
                price.toLocaleString(undefined, {maximumFractionDigits: 2}) : 
                price.toFixed(4);
            priceEl.textContent = formatPrice;
            
            // Update trade form price input (only if user hasn't modified it)
            const priceInput = document.getElementById('priceInput');
            const priceApprox = document.getElementById('priceApprox');
            if (priceInput && document.activeElement !== priceInput) {
                priceInput.value = formatPrice.replace(/,/g, '');
            }
            if (priceApprox) {
                priceApprox.textContent = 'â‰ˆ $' + formatPrice;
            }
            
            lastPrice = price;
        }

        function updateHeaderStats(stats) {
            // Update 24h change
            const changeEl = document.getElementById('priceChange');
            if (changeEl) {
                changeEl.textContent = `${stats.change >= 0 ? '+' : ''}${stats.change.toFixed(2)}%`;
                changeEl.className = `header-stat-value ${stats.change >= 0 ? 'positive' : 'negative'}`;
            }
            
            // Update 24h high
            const highEl = document.getElementById('high24h');
            if (highEl) {
                highEl.textContent = stats.high > 100 ? stats.high.toLocaleString(undefined, {maximumFractionDigits: 2}) : stats.high.toFixed(4);
            }
            
            // Update 24h low
            const lowEl = document.getElementById('low24h');
            if (lowEl) {
                lowEl.textContent = stats.low > 100 ? stats.low.toLocaleString(undefined, {maximumFractionDigits: 2}) : stats.low.toFixed(4);
            }
            
            // Update volume
            const volEl = document.getElementById('volume24h');
            if (volEl) {
                const volDisplay = stats.volume > 1000000 ? 
                    (stats.volume / 1000000).toFixed(2) + 'M' : 
                    stats.volume.toLocaleString(undefined, {maximumFractionDigits: 0});
                volEl.textContent = volDisplay;
            }
            
            // Update quote volume (USDT)
            const quoteVolEl = document.getElementById('volumeUsdt24h');
            if (quoteVolEl) {
                const quoteVolDisplay = stats.quoteVolume > 1000000000 ? 
                    (stats.quoteVolume / 1000000000).toFixed(2) + 'B' :
                    stats.quoteVolume > 1000000 ? 
                    (stats.quoteVolume / 1000000).toFixed(2) + 'M' : 
                    stats.quoteVolume.toLocaleString(undefined, {maximumFractionDigits: 0});
                quoteVolEl.textContent = quoteVolDisplay;
            }
        }

        // Fallback REST API
        async function fetchOrderBookREST() {
            try {
                const response = await fetch(`https://api.binance.com/api/v3/depth?symbol=${currentSymbol}&limit=20`);
                const data = await response.json();
                
                liveOrderBook = {
                    bids: data.bids.slice(0, 8).map(([price, amount]) => ({
                        price: parseFloat(price),
                        amount: parseFloat(amount)
                    })),
                    asks: data.asks.slice(0, 8).map(([price, amount]) => ({
                        price: parseFloat(price),
                        amount: parseFloat(amount)
                    }))
                };
                renderLiveOrderBook();
                drawLiveDepthChart();
            } catch (e) {
                
                renderOrderBook();
                drawDepthChart();
            }
        }

        // ===== ORDER BOOK =====
        function generateOrderBook() {
            const basePrice = 2.3824;
            const asks = [], bids = [];
            for (let i = 0; i < 8; i++) {
                asks.push({
                    price: (basePrice + 0.001 * (i + 1)).toFixed(4),
                    amount: (Math.random() * 3000 + 1000).toFixed(2),
                    depth: Math.random() * 100
                });
                bids.push({
                    price: (basePrice - 0.001 * (i + 1)).toFixed(4),
                    amount: (Math.random() * 3000 + 1000).toFixed(2),
                    depth: Math.random() * 100
                });
            }
            return { asks: asks.reverse(), bids };
        }

        function renderOrderBook() {
            const { asks, bids } = generateOrderBook();
            document.getElementById('asksList').innerHTML = asks.map(o => `
                <div class="ob-row ask">
                    <div class="depth-bar" style="width: ${o.depth}%"></div>
                    <span class="price">${o.price}</span>
                    <span class="amount">${o.amount}</span>
                    <span class="total">${(o.price * o.amount).toFixed(2)}</span>
                </div>
            `).join('');
            document.getElementById('bidsList').innerHTML = bids.map(o => `
                <div class="ob-row bid">
                    <div class="depth-bar" style="width: ${o.depth}%"></div>
                    <span class="price">${o.price}</span>
                    <span class="amount">${o.amount}</span>
                    <span class="total">${(o.price * o.amount).toFixed(2)}</span>
                </div>
            `).join('');
        }

        function renderLiveOrderBook() {
            const { asks, bids } = liveOrderBook;
            if (!asks.length || !bids.length) return;
            
            const maxAskAmount = Math.max(...asks.map(a => a.amount));
            const maxBidAmount = Math.max(...bids.map(b => b.amount));
            const maxAmount = Math.max(maxAskAmount, maxBidAmount);
            
            // Format price based on value
            const formatPrice = (p) => p > 100 ? p.toLocaleString(undefined, {maximumFractionDigits: 2}) : p.toFixed(4);
            const formatAmount = (a) => a > 1 ? a.toFixed(4) : a.toFixed(6);
            
            document.getElementById('asksList').innerHTML = [...asks].reverse().map(o => `
                <div class="ob-row ask">
                    <div class="depth-bar" style="width: ${(o.amount / maxAmount) * 100}%"></div>
                    <span class="price">${formatPrice(o.price)}</span>
                    <span class="amount">${formatAmount(o.amount)}</span>
                    <span class="total">${(o.price * o.amount).toFixed(2)}</span>
                </div>
            `).join('');
            
            document.getElementById('bidsList').innerHTML = bids.map(o => `
                <div class="ob-row bid">
                    <div class="depth-bar" style="width: ${(o.amount / maxAmount) * 100}%"></div>
                    <span class="price">${formatPrice(o.price)}</span>
                    <span class="amount">${formatAmount(o.amount)}</span>
                    <span class="total">${(o.price * o.amount).toFixed(2)}</span>
                </div>
            `).join('');
            
            // Update spread display
            const midPrice = (asks[0].price + bids[0].price) / 2;
            const spread = asks[0].price - bids[0].price;
            const spreadPercent = (spread / asks[0].price * 100).toFixed(3);
            
            const spreadPriceEl = document.getElementById('spreadPrice');
            const spreadValueEl = document.getElementById('spreadValue');
            
            if (spreadPriceEl) {
                spreadPriceEl.textContent = '$' + formatPrice(midPrice);
            }
            if (spreadValueEl) {
                spreadValueEl.textContent = `Spread: ${spreadPercent}%`;
            }
            
            // Update timestamp
            const spreadTimeEl = document.getElementById('spreadTime');
            if (spreadTimeEl) {
                const now = new Date();
                spreadTimeEl.textContent = now.toLocaleTimeString('en-US', { 
                    hour12: false, 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
            }

            // Update buy/sell ratio bar
            const totalBidVolume = bids.reduce((sum, b) => sum + (b.price * b.amount), 0);
            const totalAskVolume = asks.reduce((sum, a) => sum + (a.price * a.amount), 0);
            const totalVolume = totalBidVolume + totalAskVolume;
            const buyPercent = ((totalBidVolume / totalVolume) * 100).toFixed(2);
            const sellPercent = ((totalAskVolume / totalVolume) * 100).toFixed(2);
            
            const buyBar = document.getElementById('obRatioBuy');
            const sellBar = document.getElementById('obRatioSell');
            const buyPercentEl = document.getElementById('buyPercent');
            const sellPercentEl = document.getElementById('sellPercent');
            
            if (buyBar && sellBar) {
                buyBar.style.width = buyPercent + '%';
                sellBar.style.width = sellPercent + '%';
            }
            if (buyPercentEl) buyPercentEl.textContent = buyPercent + '%';
            if (sellPercentEl) sellPercentEl.textContent = sellPercent + '%';
        }

        function addLiveTrade(trade) {
            const list = document.getElementById('tradesList');
            if (!list) return;
            
            // Clear the connecting message if it's there
            const connectingMsg = list.querySelector('div[style*="text-align: center"]');
            if (connectingMsg) {
                list.innerHTML = '';
            }
            
            const row = document.createElement('div');
            row.className = `trade-row ${trade.isBuy ? 'buy' : 'sell'}`;
            row.style.opacity = '0';
            row.style.transform = 'translateX(-10px)';
            
            const formatPrice = (p) => p > 100 ? p.toLocaleString(undefined, {maximumFractionDigits: 2}) : p.toFixed(4);
            const formatAmount = (a) => a > 1 ? a.toFixed(4) : a.toFixed(6);
            
            row.innerHTML = `
                <span class="trade-price">${formatPrice(trade.price)}</span>
                <span class="trade-amount">${formatAmount(trade.amount)}</span>
                <span class="trade-time">${trade.time}</span>
            `;
            
            list.insertBefore(row, list.firstChild);
            
            // Animate in
            requestAnimationFrame(() => {
                row.style.transition = 'all 0.3s ease';
                row.style.opacity = '1';
                row.style.transform = 'translateX(0)';
            });
            
            if (list.children.length > 20) list.lastChild.remove();
        }

        // ===== RECENT TRADES =====
        function initRecentTrades() {
            document.getElementById('tradesList').innerHTML = `
                <div style="text-align: center; color: var(--text-muted); padding: 20px; font-size: 12px;">
                    <div style="margin-bottom: 8px;">â³ Connecting to live feed...</div>
                    <div style="font-size: 10px; opacity: 0.7;">Trades will appear here</div>
                </div>
            `;
        }

        function switchObTab(tab) {
            document.querySelectorAll('.ob-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('orderbookContent').style.display = tab === 'orderbook' ? 'block' : 'none';
            document.getElementById('tradesContent').style.display = tab === 'trades' ? 'block' : 'none';
        }

        // ===== DEPTH CHART =====
        function drawDepthChart() {
            const canvas = document.getElementById('depthChart');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.parentElement.offsetWidth - 24;
            canvas.height = 60;

            const w = canvas.width;
            const h = canvas.height;
            const mid = w / 2;

            // Generate depth data
            const bids = [], asks = [];
            let cumBid = 0, cumAsk = 0;
            for (let i = 0; i < 20; i++) {
                cumBid += Math.random() * 500 + 200;
                cumAsk += Math.random() * 500 + 200;
                bids.push(cumBid);
                asks.push(cumAsk);
            }
            const maxDepth = Math.max(...bids, ...asks);

            // Draw bids (left side, cyan)
            ctx.beginPath();
            ctx.moveTo(mid, h);
            bids.forEach((d, i) => {
                const x = mid - (i + 1) * (mid / 20);
                const y = h - (d / maxDepth) * h * 0.9;
                ctx.lineTo(x, y);
            });
            ctx.lineTo(0, h);
            ctx.closePath();
            ctx.fillStyle = 'rgba(0, 212, 255, 0.3)';
            ctx.fill();
            ctx.strokeStyle = '#00d4ff';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw asks (right side, pink)
            ctx.beginPath();
            ctx.moveTo(mid, h);
            asks.forEach((d, i) => {
                const x = mid + (i + 1) * (mid / 20);
                const y = h - (d / maxDepth) * h * 0.9;
                ctx.lineTo(x, y);
            });
            ctx.lineTo(w, h);
            ctx.closePath();
            ctx.fillStyle = 'rgba(255, 20, 147, 0.3)';
            ctx.fill();
            ctx.strokeStyle = '#ff1493';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Center line
            ctx.beginPath();
            ctx.moveTo(mid, 0);
            ctx.lineTo(mid, h);
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function drawLiveDepthChart() {
            const canvas = document.getElementById('depthChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.parentElement.offsetWidth - 24;
            canvas.height = 60;

            const { bids, asks } = liveOrderBook;
            if (!bids.length || !asks.length) return;

            const w = canvas.width;
            const h = canvas.height;
            const mid = w / 2;

            // Calculate cumulative depth
            let cumBids = [], cumAsks = [];
            let cumBid = 0, cumAsk = 0;
            
            bids.forEach(b => {
                cumBid += b.amount;
                cumBids.push(cumBid);
            });
            
            asks.forEach(a => {
                cumAsk += a.amount;
                cumAsks.push(cumAsk);
            });
            
            const maxDepth = Math.max(...cumBids, ...cumAsks);

            // Clear canvas
            ctx.clearRect(0, 0, w, h);

            // Draw bids (left side, cyan)
            ctx.beginPath();
            ctx.moveTo(mid, h);
            cumBids.forEach((d, i) => {
                const x = mid - (i + 1) * (mid / cumBids.length);
                const y = h - (d / maxDepth) * h * 0.85;
                ctx.lineTo(x, y);
            });
            ctx.lineTo(0, h);
            ctx.closePath();
            ctx.fillStyle = 'rgba(0, 212, 255, 0.3)';
            ctx.fill();
            ctx.strokeStyle = '#00d4ff';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw asks (right side, pink)
            ctx.beginPath();
            ctx.moveTo(mid, h);
            cumAsks.forEach((d, i) => {
                const x = mid + (i + 1) * (mid / cumAsks.length);
                const y = h - (d / maxDepth) * h * 0.85;
                ctx.lineTo(x, y);
            });
            ctx.lineTo(w, h);
            ctx.closePath();
            ctx.fillStyle = 'rgba(255, 20, 147, 0.3)';
            ctx.fill();
            ctx.strokeStyle = '#ff1493';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Center line
            ctx.beginPath();
            ctx.moveTo(mid, 0);
            ctx.lineTo(mid, h);
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        // ===== TRADINGVIEW WIDGET =====
        function initTradingView() {
            if (typeof TradingView !== 'undefined') {
                new TradingView.widget({
                    "autosize": true,
                    "symbol": "BINANCE:BTCUSDT",
                    "interval": "15",
                    "timezone": "Etc/UTC",
                    "theme": "dark",
                    "style": "1",
                    "locale": "en",
                    "toolbar_bg": "#0f0f1e",
                    "enable_publishing": false,
                    "hide_side_toolbar": false,
                    "hide_top_toolbar": false,
                    "hide_legend": false,
                    "allow_symbol_change": true,
                    "container_id": "tradingview_chart",
                    "hide_volume": false,
                    "withdateranges": true,
                    "save_image": false,
                    "backgroundColor": "#0f0f1e",
                    "gridColor": "rgba(0, 212, 255, 0.1)",
                    "overrides": {
                        "paneProperties.background": "#0f0f1e",
                        "paneProperties.backgroundType": "solid",
                        "paneProperties.vertGridProperties.color": "rgba(0, 212, 255, 0.1)",
                        "paneProperties.horzGridProperties.color": "rgba(0, 212, 255, 0.1)",
                        "mainSeriesProperties.candleStyle.upColor": "#00d4ff",
                        "mainSeriesProperties.candleStyle.downColor": "#ff1493",
                        "mainSeriesProperties.candleStyle.borderUpColor": "#00d4ff",
                        "mainSeriesProperties.candleStyle.borderDownColor": "#ff1493",
                        "mainSeriesProperties.candleStyle.wickUpColor": "#00d4ff",
                        "mainSeriesProperties.candleStyle.wickDownColor": "#ff1493",
                        "volumePaneSize": "small",
                        "scalesProperties.showSeriesLastValue": true,
                        "mainSeriesProperties.showCountdown": true
                    },
                    "studies_overrides": {
                        "volume.volume.color.0": "#ff1493",
                        "volume.volume.color.1": "#00d4ff"
                    }
                });
            }
        }

        // ===== TRADE FORM (Bitunix Style) =====
        let currentLeverage = 20;

        function setOcTab(el, mode) {
            document.querySelectorAll('.oc-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        }

        function setOtBtn(el) {
            document.querySelectorAll('.ot-btn').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        }

        function setLastPrice() {
            const price = document.getElementById('spreadPrice')?.textContent?.replace(/[^0-9.]/g, '') || '86802.9';
            document.getElementById('priceInput').value = parseFloat(price).toLocaleString();
        }

        function adjustPrice(delta) {
            const input = document.getElementById('priceInput');
            const currentVal = parseFloat(input.value.replace(/,/g, '')) || 0;
            const newVal = currentVal + delta;
            input.value = newVal.toLocaleString();
        }

        function setPct(pct) {
            document.getElementById('pctSlider').value = pct;
            setPctSlider(pct);
        }

        function setPctSlider(pct) {
            const avail = 5000;
            const price = parseFloat(document.getElementById('priceInput').value.replace(/,/g, '')) || 86802.9;
            const amount = (avail * (pct / 100) * currentLeverage / price).toFixed(4);
            document.getElementById('amountInput').value = amount;
            updateCostInfo();
        }

        function updateCostInfo() {
            const price = parseFloat(document.getElementById('priceInput').value.replace(/,/g, '')) || 0;
            const amount = parseFloat(document.getElementById('amountInput').value) || 0;
            const cost = (price * amount / currentLeverage).toFixed(2);
            
            document.getElementById('longCost').textContent = cost + ' USDT';
            document.getElementById('shortCost').textContent = cost + ' USDT';
            document.getElementById('longMax').textContent = amount + ' BTC';
            document.getElementById('shortMax').textContent = amount + ' BTC';
        }

        function openPosition(direction) {
            const price = document.getElementById('priceInput').value;
            const qty = document.getElementById('amountInput').value;
            
            if (!qty || parseFloat(qty) <= 0) {
                showToast('error', 'Invalid Order', 'Please enter a quantity');
                return;
            }
            
            showToast('success', `${direction.toUpperCase()} Order`, `Opening ${direction} position: ${qty} BTC @ $${price} (${currentLeverage}X)`);
            playSound();
        }

        // ===== QUICK TRADE MODAL =====
        let qtmLeverage = 20;
        let quickTradeOpen = false;

        function openQuickTrade() {
            document.getElementById('quickTradeModal').classList.add('active');
            quickTradeOpen = true;
            updateQtmData();
            playSound('open');
        }

        function closeQuickTrade() {
            document.getElementById('quickTradeModal').classList.remove('active');
            quickTradeOpen = false;
        }

        function updateQtmData() {
            // Update modal with current price data
            const price = document.getElementById('spreadPrice')?.textContent || '$87,500.00';
            document.getElementById('qtmPrice').textContent = price;
            document.getElementById('qtmSymbol').textContent = selectedPairData.symbol + '/USDT';
            
            // Update mini order book from live data
            if (liveOrderBook.asks.length && liveOrderBook.bids.length) {
                const formatP = (p) => p.toLocaleString(undefined, {maximumFractionDigits: 2});
                const formatA = (a) => a.toFixed(3);
                
                document.getElementById('qtmAsks').innerHTML = liveOrderBook.asks.slice(0, 3).reverse().map(a => 
                    `<div class="qtm-row ask"><span>${formatP(a.price)}</span><span>${formatA(a.amount)}</span></div>`
                ).join('');
                
                document.getElementById('qtmBids').innerHTML = liveOrderBook.bids.slice(0, 3).map(b => 
                    `<div class="qtm-row bid"><span>${formatP(b.price)}</span><span>${formatA(b.amount)}</span></div>`
                ).join('');
            }
        }

        function setQtmLev(lev) {
            qtmLeverage = lev;
            document.querySelectorAll('.qtm-lev-btns button').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            updateQtmLiq();
            playSound('click');
        }

        function setQtmAmount(amt) {
            document.getElementById('qtmAmount').value = amt;
            updateQtmLiq();
            playSound('click');
        }

        function updateQtmLiq() {
            const price = parseFloat(document.getElementById('spreadPrice')?.textContent?.replace(/[^0-9.]/g, '') || 87500);
            const liqPrice = price * (1 - (1 / qtmLeverage) * 0.9);
            document.getElementById('qtmLiq').textContent = '$' + liqPrice.toLocaleString(undefined, {maximumFractionDigits: 0});
        }

        function toggleQtmTpsl() {
            const enabled = document.getElementById('qtmTpslEnabled').checked;
            const inputs = document.getElementById('qtmTpslInputs');
            if (inputs) {
                inputs.classList.toggle('hidden', !enabled);
            }
            playSound('click');
        }

        // Update TP/SL percentages as user types
        document.getElementById('qtmTp')?.addEventListener('input', function() {
            const price = parseFloat(document.getElementById('spreadPrice')?.textContent?.replace(/[^0-9.]/g, '') || 87500);
            const tp = parseFloat(this.value) || 0;
            if (tp > 0) {
                const pct = ((tp - price) / price * 100).toFixed(1);
                document.getElementById('qtmTpPct').textContent = (pct >= 0 ? '+' : '') + pct + '%';
                document.getElementById('qtmTpPct').style.color = pct >= 0 ? 'var(--cyan)' : 'var(--pink)';
            } else {
                document.getElementById('qtmTpPct').textContent = '+0%';
                document.getElementById('qtmTpPct').style.color = 'var(--text-muted)';
            }
        });

        document.getElementById('qtmSl')?.addEventListener('input', function() {
            const price = parseFloat(document.getElementById('spreadPrice')?.textContent?.replace(/[^0-9.]/g, '') || 87500);
            const sl = parseFloat(this.value) || 0;
            if (sl > 0) {
                const pct = ((sl - price) / price * 100).toFixed(1);
                document.getElementById('qtmSlPct').textContent = (pct >= 0 ? '+' : '') + pct + '%';
                document.getElementById('qtmSlPct').style.color = pct >= 0 ? 'var(--cyan)' : 'var(--pink)';
            } else {
                document.getElementById('qtmSlPct').textContent = '-0%';
                document.getElementById('qtmSlPct').style.color = 'var(--text-muted)';
            }
        });

        function setQtmTpPct(pct) {
            const price = parseFloat(document.getElementById('spreadPrice')?.textContent?.replace(/[^0-9.]/g, '') || 87500);
            const tpPrice = price * (1 + pct / 100);
            document.getElementById('qtmTp').value = tpPrice.toFixed(2);
            document.getElementById('qtmTpPct').textContent = '+' + pct + '%';
            document.getElementById('qtmTpPct').style.color = 'var(--cyan)';
            
            // Update active state on buttons
            document.querySelectorAll('.qtm-tpsl-row:first-child .qtm-quick-pct button').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            playSound('click');
        }

        function setQtmSlPct(pct) {
            const price = parseFloat(document.getElementById('spreadPrice')?.textContent?.replace(/[^0-9.]/g, '') || 87500);
            const slPrice = price * (1 - pct / 100);
            document.getElementById('qtmSl').value = slPrice.toFixed(2);
            document.getElementById('qtmSlPct').textContent = '-' + pct + '%';
            document.getElementById('qtmSlPct').style.color = 'var(--pink)';
            
            // Update active state on buttons
            document.querySelectorAll('.qtm-tpsl-row:last-child .qtm-quick-pct button').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            playSound('click');
        }

        function executeQuickTrade(direction) {
            const amount = document.getElementById('qtmAmount').value;
            const price = document.getElementById('qtmPrice').textContent;
            const tpslEnabled = document.getElementById('qtmTpslEnabled').checked;
            const tp = document.getElementById('qtmTp').value;
            const sl = document.getElementById('qtmSl').value;
            
            if (!amount || parseFloat(amount) <= 0) {
                showToast('error', 'Invalid Amount', 'Please enter a valid amount');
                playSound('error');
                return;
            }

            // Play trade sound
            playSound('trade');
            
            // Build message with TP/SL if set
            let msg = `${selectedPairData.symbol} ${direction} $${amount} @ ${price} (${qtmLeverage}x)`;
            if (tpslEnabled && (tp || sl)) {
                msg += '\n';
                if (tp) msg += `TP: $${tp} `;
                if (sl) msg += `SL: $${sl}`;
            }
            
            // Show success with confetti
            showToast('success', `${direction.toUpperCase()} Order Placed! ðŸš€`, msg);
            
            // Trigger confetti
            triggerConfetti();
            
            closeQuickTrade();
        }

        // ===== KEYBOARD SHORTCUTS =====
        document.addEventListener('keydown', function(e) {
            // Don't trigger if typing in an input
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            switch(e.key.toLowerCase()) {
                case 't':
                    if (!quickTradeOpen) {
                        openQuickTrade();
                    }
                    break;
                case 'b':
                    if (quickTradeOpen) {
                        executeQuickTrade('long');
                    }
                    break;
                case 's':
                    if (quickTradeOpen) {
                        executeQuickTrade('short');
                    }
                    break;
                case 'escape':
                    if (quickTradeOpen) {
                        closeQuickTrade();
                    }
                    break;
            }
        });

        // ===== SOUND EFFECTS =====
        const sounds = {
            click: { freq: 800, duration: 50, type: 'sine' },
            open: { freq: 600, duration: 100, type: 'sine', freq2: 900 },
            trade: { freq: 400, duration: 150, type: 'square', freq2: 600, freq3: 800 },
            error: { freq: 200, duration: 200, type: 'sawtooth' },
            success: { freq: 523, duration: 100, type: 'sine', freq2: 659, freq3: 784 }
        };

        let audioCtx = null;

        function playSound(type = 'click') {
            try {
                if (!audioCtx) {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const sound = sounds[type] || sounds.click;
                
                const playTone = (freq, delay = 0) => {
                    const oscillator = audioCtx.createOscillator();
                    const gainNode = audioCtx.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioCtx.destination);
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = sound.type;
                    
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime + delay);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + delay + sound.duration / 1000);
                    
                    oscillator.start(audioCtx.currentTime + delay);
                    oscillator.stop(audioCtx.currentTime + delay + sound.duration / 1000);
                };
                
                playTone(sound.freq, 0);
                if (sound.freq2) playTone(sound.freq2, 0.08);
                if (sound.freq3) playTone(sound.freq3, 0.16);
                
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        // ===== CONFETTI EFFECT =====
        function triggerConfetti() {
            const colors = ['#00d4ff', '#8a2be2', '#ff1493', '#00ff88'];
            const confettiCount = 100;
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.cssText = `
                    position: fixed;
                    width: ${Math.random() * 10 + 5}px;
                    height: ${Math.random() * 10 + 5}px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    left: ${Math.random() * 100}vw;
                    top: -20px;
                    border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                    pointer-events: none;
                    z-index: 10000;
                    animation: confettiFall ${Math.random() * 2 + 2}s linear forwards;
                `;
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 4000);
            }
        }

        // Add confetti animation style
        const confettiStyle = document.createElement('style');
        confettiStyle.textContent = `
            @keyframes confettiFall {
                0% { transform: translateY(0) rotate(0deg); opacity: 1; }
                100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
            }
        `;
        document.head.appendChild(confettiStyle);

        function toggleTradeForm() {
            const content = document.getElementById('tradeFormContent');
            const toggle = document.getElementById('tradeFormToggle');
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                toggle.classList.remove('open');
            } else {
                content.classList.add('expanded');
                toggle.classList.add('open');
            }
        }

        function toggleNews() {
            const feed = document.getElementById('newsFeed');
            const toggle = document.getElementById('newsToggle');
            if (feed.classList.contains('news-collapsed')) {
                feed.classList.remove('news-collapsed');
                feed.classList.add('news-expanded');
                toggle.classList.add('open');
            } else {
                feed.classList.remove('news-expanded');
                feed.classList.add('news-collapsed');
                toggle.classList.remove('open');
            }
        }

        function toggleTpsl() {
            const enabled = document.getElementById('tpslEnabled').checked;
            const inputs = document.getElementById('tpslInputs');
            if (inputs) {
                inputs.style.display = enabled ? 'flex' : 'none';
            }
        }

        function openLeverageModal() {
            const newLev = prompt('Enter leverage (1-125):', currentLeverage);
            if (newLev && !isNaN(newLev)) {
                currentLeverage = Math.min(125, Math.max(1, parseInt(newLev)));
                document.getElementById('leverageDisplay').textContent = currentLeverage + 'X';
                updateCostInfo();
            }
        }

        // Input listeners
        document.getElementById('amountInput')?.addEventListener('input', updateCostInfo);
        document.getElementById('priceInput')?.addEventListener('input', updateCostInfo);

        // ===== MODALS =====
        function openWalletModal() {
            document.getElementById('walletModal').classList.add('active');
        }
        function closeWalletModal() {
            document.getElementById('walletModal').classList.remove('active');
        }
        function connectWallet(type) {
            closeWalletModal();
            showToast('success', 'Wallet Connected', `${type} wallet connected successfully!`);
            document.getElementById('walletBtn').classList.add('connected');
            document.getElementById('walletBtn').innerHTML = `
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
                <span>0x7a3...4f2</span>
            `;
            playSound();
            
            // Success pulse on wallet button
            const btn = document.getElementById('walletBtn');
            btn.classList.add('success-pulse');
            setTimeout(() => btn.classList.remove('success-pulse'), 500);
        }

        function openConfirmModal() {
            const price = document.getElementById('priceInput').value;
            const amount = document.getElementById('amountInput').value;
            const total = document.getElementById('orderTotal').textContent;
            
            document.getElementById('confirmType').textContent = tradeType.toUpperCase();
            document.getElementById('confirmType').style.color = tradeType === 'buy' ? 'var(--cyan)' : 'var(--pink)';
            document.getElementById('confirmPrice').textContent = price + ' USDT';
            document.getElementById('confirmAmount').textContent = amount + ' MX1';
            document.getElementById('confirmLeverage').textContent = leverage + 'x';
            document.getElementById('confirmTotal').textContent = total;
            
            document.getElementById('confirmModal').classList.add('active');
        }
        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('active');
        }
        function executeOrder() {
            closeConfirmModal();
            playSound();
            triggerConfetti(); // ðŸŽ‰ Epic confetti!
            showToast('success', 'Order Executed', `${tradeType.toUpperCase()} order placed successfully!`);
            
            // Add success pulse to submit button
            const btn = document.getElementById('submitBtn');
            btn.classList.add('success-pulse');
            setTimeout(() => btn.classList.remove('success-pulse'), 500);
        }

        function openAlertModal() {
            document.getElementById('alertModal').classList.add('active');
        }
        function closeAlertModal() {
            document.getElementById('alertModal').classList.remove('active');
        }
        function saveAlert() {
            const price = document.getElementById('alertPrice').value;
            closeAlertModal();
            showToast('success', 'Alert Created', `Price alert set for $${price}`);
            playSound();
        }

        // ===== THEME TOGGLE =====
        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            document.documentElement.setAttribute('data-theme', isDarkTheme ? 'dark' : 'light');
            const icon = document.getElementById('themeIcon');
            if (isDarkTheme) {
                icon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>';
            } else {
                icon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
            }
        }

        // ===== AI CHAT =====
        function toggleAiChat() {
            document.getElementById('aiChat').classList.toggle('open');
        }

        function sendAiMessage() {
            const input = document.getElementById('aiInput');
            const message = input.value.trim();
            if (!message) return;

            const messages = document.getElementById('aiMessages');
            messages.innerHTML += `<div class="ai-message user">${message}</div>`;
            input.value = '';

            setTimeout(() => {
                const responses = [
                    "Based on current market trends, MX1 shows strong bullish momentum. Consider setting a stop-loss at $2.30.",
                    "The Fear & Greed index is at 72, indicating market greed. This could be a good time to take some profits.",
                    "I've analyzed the order book - there's significant buy support around $2.35. This could act as a strong resistance.",
                    "Looking at the 15-minute chart, we're seeing a potential breakout pattern forming. Watch for volume confirmation!"
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                messages.innerHTML += `<div class="ai-message bot">${response}</div>`;
                messages.scrollTop = messages.scrollHeight;
            }, 1000);
        }

        // ===== TOAST NOTIFICATIONS =====
        function showToast(type, title, message) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="toast-icon">
                    ${type === 'success' ? 'âœ“' : 'âœ•'}
                </div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
            `;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        // ===== SOUND EFFECTS =====
        function playSound() {
            if (!soundEnabled) return;
            try {
                const audio = document.getElementById('successSound');
                audio.currentTime = 0;
                audio.play();
            } catch (e) {}
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            const btn = document.getElementById('soundToggle');
            const icon = document.getElementById('soundIcon');
            
            if (soundEnabled) {
                btn.classList.remove('muted');
                icon.innerHTML = `
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                `;
                showToast('success', 'Sound On', 'Sound effects enabled');
            } else {
                btn.classList.add('muted');
                icon.innerHTML = `
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                    <line x1="23" y1="9" x2="17" y2="15"></line>
                    <line x1="17" y1="9" x2="23" y2="15"></line>
                `;
                showToast('success', 'Sound Off', 'Sound effects muted');
            }
        }

        // ===== KEYBOARD SHORTCUTS =====
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT') return;
            if (e.key === 'b' || e.key === 'B') setTradeType('buy');
            if (e.key === 's' || e.key === 'S') setTradeType('sell');
            if (e.key === 'Escape') {
                closeWalletModal();
                closeConfirmModal();
                closeAlertModal();
            }
        });

        // ===== SOCIAL SENTIMENT =====
        // Try to fetch real data, fall back to simulation
        let sentimentData = {
            BTC: { score: 78, trend: 'bullish', twitter: 82, reddit: 74, news: 71, telegram: 79 },
            ETH: { score: 72, trend: 'bullish', twitter: 75, reddit: 68, news: 70, telegram: 74 },
            SOL: { score: 85, trend: 'bullish', twitter: 89, reddit: 82, news: 80, telegram: 88 },
            XRP: { score: 45, trend: 'neutral', twitter: 48, reddit: 42, news: 44, telegram: 46 },
            DOGE: { score: 92, trend: 'bullish', twitter: 95, reddit: 91, news: 85, telegram: 94 },
            ADA: { score: 38, trend: 'bearish', twitter: 35, reddit: 40, news: 42, telegram: 36 },
            AVAX: { score: 65, trend: 'bullish', twitter: 68, reddit: 62, news: 64, telegram: 66 },
            LINK: { score: 71, trend: 'bullish', twitter: 74, reddit: 69, news: 68, telegram: 72 },
            DOT: { score: 42, trend: 'bearish', twitter: 40, reddit: 44, news: 45, telegram: 39 },
            MATIC: { score: 58, trend: 'neutral', twitter: 60, reddit: 55, news: 58, telegram: 59 },
            MX1: { score: 88, trend: 'bullish', twitter: 91, reddit: 85, news: 84, telegram: 90 }
        };
        
        let sentimentApiAvailable = false;

        // Try to fetch real sentiment from CryptoCompare (free, no API key needed for basic)
        async function fetchRealSentiment(symbol) {
            try {
                // CryptoCompare social stats endpoint
                const response = await fetch(`https://min-api.cryptocompare.com/data/social/coin/latest?coinId=${getCoinId(symbol)}`);
                if (!response.ok) throw new Error('API failed');
                
                const data = await response.json();
                if (data && data.Data) {
                    sentimentApiAvailable = true;
                    const social = data.Data;
                    
                    // Extract real metrics
                    const twitter = social.Twitter ? Math.min(95, Math.max(5, Math.round(social.Twitter.followers / 10000))) : 50;
                    const reddit = social.Reddit ? Math.min(95, Math.max(5, Math.round(social.Reddit.subscribers / 10000))) : 50;
                    const codeRepo = social.CodeRepository ? Math.min(95, Math.max(5, social.CodeRepository.Stars / 1000)) : 50;
                    
                    // Calculate sentiment score based on recent activity
                    const score = Math.round((twitter + reddit + codeRepo) / 3);
                    const trend = score >= 60 ? 'bullish' : score <= 40 ? 'bearish' : 'neutral';
                    
                    sentimentData[symbol] = {
                        score: score,
                        trend: trend,
                        twitter: twitter,
                        reddit: reddit,
                        news: Math.round(score + (Math.random() * 10 - 5)),
                        telegram: Math.round(score + (Math.random() * 10 - 5))
                    };
                    
                    // Update footer to show real data
                    const footer = document.getElementById('sentimentFooter');
                    if (footer) footer.textContent = 'ðŸŸ¢ Live data from CryptoCompare';
                    
                    
                    return true;
                }
            } catch (e) {
                
                const footer = document.getElementById('sentimentFooter');
                if (footer) footer.textContent = 'âšª Simulated â€¢ Updates every 20s';
                return false;
            }
            return false;
        }

        // CryptoCompare coin IDs
        function getCoinId(symbol) {
            const ids = {
                BTC: 1182, ETH: 7605, SOL: 934443, XRP: 5031,
                DOGE: 4432, ADA: 321992, AVAX: 934444, LINK: 236131,
                DOT: 891618, MATIC: 360835
            };
            return ids[symbol] || 1182;
        }

        // Update sentiment values periodically
        function startSentimentUpdates() {
            setInterval(async () => {
                const currentSymbol = document.getElementById('sentimentSymbol')?.textContent;
                
                // Try real API first
                if (currentSymbol && currentSymbol !== 'MX1') {
                    const gotReal = await fetchRealSentiment(currentSymbol);
                    if (gotReal) {
                        updateSentiment(currentSymbol);
                        return;
                    }
                }
                
                // Fall back to simulation if API fails
                Object.keys(sentimentData).forEach(symbol => {
                    const data = sentimentData[symbol];
                    
                    // 20% chance of a BIG swing (-15 to +15), otherwise small (-3 to +3)
                    const bigSwing = Math.random() < 0.2;
                    const range = bigSwing ? 30 : 6;
                    const offset = bigSwing ? 15 : 3;
                    
                    data.twitter = Math.max(5, Math.min(95, data.twitter + Math.floor(Math.random() * range) - offset));
                    data.reddit = Math.max(5, Math.min(95, data.reddit + Math.floor(Math.random() * range) - offset));
                    data.news = Math.max(5, Math.min(95, data.news + Math.floor(Math.random() * range) - offset));
                    data.telegram = Math.max(5, Math.min(95, data.telegram + Math.floor(Math.random() * range) - offset));
                    
                    data.score = Math.round((data.twitter + data.reddit + data.news + data.telegram) / 4);
                    
                    if (data.score >= 60) data.trend = 'bullish';
                    else if (data.score <= 40) data.trend = 'bearish';
                    else data.trend = 'neutral';
                });
                
                if (currentSymbol && sentimentData[currentSymbol]) {
                    updateSentiment(currentSymbol);
                }
            }, 20000);
        }

        function toggleSentimentDropdown() {
            const indicator = document.getElementById('sentimentIndicator');
            indicator.classList.toggle('open');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const indicator = document.getElementById('sentimentIndicator');
            if (indicator && !indicator.contains(e.target)) {
                indicator.classList.remove('open');
            }
        });

        function updateSentiment(symbol) {
            const data = sentimentData[symbol] || { score: 50, trend: 'neutral', twitter: 50, reddit: 50, news: 50, telegram: 50 };
            const score = data.score;
            const trend = data.trend;
            
            // Update symbol labels
            document.getElementById('sentimentSymbol').textContent = symbol;
            document.getElementById('sentimentDropdownSymbol').textContent = symbol;
            
            // Update compact view
            const fill = document.getElementById('sentimentFill');
            fill.style.width = score + '%';
            fill.className = 'sentiment-fill ' + trend;
            
            document.getElementById('sentimentPercent').textContent = score + '%';
            
            const icon = document.getElementById('sentimentIcon');
            icon.textContent = trend === 'bullish' ? 'ðŸ“ˆ' : trend === 'bearish' ? 'ðŸ“‰' : 'âž¡ï¸';
            
            const tag = document.getElementById('sentimentTag');
            tag.textContent = trend.charAt(0).toUpperCase() + trend.slice(1);
            tag.className = 'sentiment-tag ' + trend;
            
            // Update dropdown view
            document.getElementById('sentimentMainFill').style.width = score + '%';
            document.getElementById('sentimentMainPercent').textContent = score + '%';
            
            const mainTag = document.getElementById('sentimentMainTag');
            mainTag.textContent = trend.charAt(0).toUpperCase() + trend.slice(1);
            mainTag.className = 'sentiment-main-tag ' + trend;
            
            // Update sources
            updateSource('sentimentTwitter', data.twitter, trend);
            updateSource('sentimentReddit', data.reddit, trend);
            updateSource('sentimentNews', data.news, trend);
            updateSource('sentimentTelegram', data.telegram, trend);
        }

        function updateSource(id, value, trend) {
            const el = document.getElementById(id);
            if (el) {
                el.textContent = value + '%';
                const trendEl = el.nextElementSibling;
                if (trendEl) {
                    if (value >= 60) {
                        trendEl.textContent = 'ðŸ“ˆ';
                        trendEl.className = 'source-trend bullish';
                    } else if (value <= 40) {
                        trendEl.textContent = 'ðŸ“‰';
                        trendEl.className = 'source-trend bearish';
                    } else {
                        trendEl.textContent = 'âž¡ï¸';
                        trendEl.className = 'source-trend neutral';
                    }
                }
            }
        }

        async function initSentiment() {
            // Try to fetch real data for BTC first
            const gotReal = await fetchRealSentiment('BTC');
            if (gotReal) {
                showToast('success', 'Sentiment', 'Live social data connected');
            }
            
            // Initialize display with BTC
            updateSentiment('BTC');
            
            // Start periodic updates
            startSentimentUpdates();
        }

        // ===== MARKET INTELLIGENCE =====
        
        // Binance API for real-time market data
        let marketData = [];
        let heatmapApiAvailable = false;
        
        // Heatmap data
        const heatmapCoins = [
            'BTC', 'ETH', 'BNB', 'SOL', 'XRP',
            'DOGE', 'ADA', 'AVAX', 'LINK', 'DOT',
            'MATIC', 'SHIB', 'LTC', 'UNI', 'ATOM',
            'XLM', 'FIL', 'NEAR', 'APT', 'ARB'
        ];
        
        let heatmapData = {};
        
        async function fetchBinanceTickerData() {
            try {
                const response = await fetch('https://api.binance.com/api/v3/ticker/24hr');
                if (!response.ok) throw new Error('API failed');
                
                marketData = await response.json();
                heatmapApiAvailable = true;
                
                // Update heatmap badge to show LIVE
                const badge = document.querySelector('.heatmap-widget .widget-badge');
                if (badge) {
                    badge.textContent = 'LIVE';
                    badge.classList.add('live');
                }
                
                return true;
            } catch (e) {
                heatmapApiAvailable = false;
                
                // Update badge to show DEMO
                const badge = document.querySelector('.heatmap-widget .widget-badge');
                if (badge) {
                    badge.textContent = 'DEMO';
                    badge.classList.remove('live');
                }
                
                return false;
            }
        }
        
        async function initHeatmap() {
            // Try to fetch real data first
            const gotReal = await fetchBinanceTickerData();
            
            if (gotReal) {
                updateHeatmapFromAPI();
            } else {
                // Initialize with random data as fallback
                heatmapCoins.forEach(coin => {
                    heatmapData[coin] = (Math.random() - 0.5) * 10;
                });
                renderHeatmap();
            }
            
            // Update every 2 seconds (Binance is fast!)
            setInterval(async () => {
                if (heatmapApiAvailable) {
                    await fetchBinanceTickerData();
                    updateHeatmapFromAPI();
                } else {
                    // Try to reconnect
                    const reconnected = await fetchBinanceTickerData();
                    if (reconnected) {
                        updateHeatmapFromAPI();
                    } else {
                        updateHeatmapSimulated();
                    }
                }
            }, 2000);
        }
        
        function updateHeatmapFromAPI() {
            heatmapCoins.forEach(coin => {
                const symbol = coin + 'USDT';
                const coinData = marketData.find(c => c.symbol === symbol);
                
                if (coinData && coinData.priceChangePercent !== null) {
                    heatmapData[coin] = parseFloat(coinData.priceChangePercent);
                } else {
                    // Fallback to simulation for missing coins
                    if (!heatmapData[coin]) heatmapData[coin] = 0;
                }
            });
            renderHeatmap();
        }
        
        function updateHeatmapSimulated() {
            heatmapCoins.forEach(coin => {
                // Random walk with occasional big moves
                const bigMove = Math.random() < 0.1;
                const change = bigMove ? (Math.random() - 0.5) * 5 : (Math.random() - 0.5) * 1;
                heatmapData[coin] = Math.max(-15, Math.min(15, heatmapData[coin] + change));
            });
            renderHeatmap();
        }
        
        function renderHeatmap() {
            const grid = document.getElementById('heatmapGrid');
            if (!grid) return;
            
            grid.innerHTML = heatmapCoins.map(coin => {
                const change = heatmapData[coin];
                let colorClass = 'neutral';
                
                if (change > 5) colorClass = 'up-strong';
                else if (change > 2) colorClass = 'up-medium';
                else if (change > 0.5) colorClass = 'up-weak';
                else if (change < -5) colorClass = 'down-strong';
                else if (change < -2) colorClass = 'down-medium';
                else if (change < -0.5) colorClass = 'down-weak';
                
                return `
                    <div class="heatmap-cell ${colorClass}" onclick="selectPair('${coin}')">
                        <span class="symbol">${coin}</span>
                        <span class="change">${change >= 0 ? '+' : ''}${change.toFixed(2)}%</span>
                    </div>
                `;
            }).join('');
        }
        
        // Whale Alerts
        const whaleAlertTypes = [
            { type: 'whale', icon: 'ðŸ‹', title: '{amount} {coin} transferred', subtitle: 'From {from} to {to}' },
            { type: 'whale', icon: 'ðŸ‹', title: '{amount} {coin} moved to exchange', subtitle: 'Potential sell pressure' },
            { type: 'whale', icon: 'ðŸ‹', title: '{amount} {coin} withdrawn from exchange', subtitle: 'Accumulation signal' },
            { type: 'liquidation-long', icon: 'ðŸ’€', title: 'LONG Liquidated', subtitle: '{coin} @ ${price}' },
            { type: 'liquidation-short', icon: 'ðŸš€', title: 'SHORT Liquidated', subtitle: '{coin} @ ${price}' },
        ];
        
        const whaleCoins = ['BTC', 'ETH', 'SOL', 'XRP', 'BNB'];
        const exchanges = ['Binance', 'Coinbase', 'Kraken', 'OKX', 'Bybit'];
        const wallets = ['Unknown Wallet', 'Whale Wallet', 'Institution', 'Market Maker'];
        
        let whaleAlerts = [];
        
        function initWhaleAlerts() {
            // Generate initial alerts
            for (let i = 0; i < 5; i++) {
                addWhaleAlert(false);
            }
            renderWhaleAlerts();
            
            // Add new alert every 8-15 seconds
            scheduleNextWhaleAlert();
        }
        
        function scheduleNextWhaleAlert() {
            const delay = Math.random() * 7000 + 8000; // 8-15 seconds
            setTimeout(() => {
                addWhaleAlert(true);
                scheduleNextWhaleAlert();
            }, delay);
        }
        
        function addWhaleAlert(animate = true) {
            const template = whaleAlertTypes[Math.floor(Math.random() * whaleAlertTypes.length)];
            const coin = whaleCoins[Math.floor(Math.random() * whaleCoins.length)];
            const exchange = exchanges[Math.floor(Math.random() * exchanges.length)];
            const wallet = wallets[Math.floor(Math.random() * wallets.length)];
            
            let amount, value;
            if (coin === 'BTC') {
                amount = (Math.random() * 500 + 100).toFixed(0);
                value = (amount * 87500).toLocaleString();
            } else if (coin === 'ETH') {
                amount = (Math.random() * 5000 + 1000).toFixed(0);
                value = (amount * 3100).toLocaleString();
            } else {
                amount = (Math.random() * 1000000 + 100000).toFixed(0);
                value = (amount * (Math.random() * 5 + 0.5)).toLocaleString();
            }
            
            const price = coin === 'BTC' ? (87000 + Math.random() * 1000).toFixed(2) : 
                          coin === 'ETH' ? (3050 + Math.random() * 100).toFixed(2) :
                          (Math.random() * 100 + 1).toFixed(2);
            
            const liquidationValue = (Math.random() * 5 + 0.5).toFixed(2) + 'M';
            
            let title = template.title
                .replace('{amount}', Number(amount).toLocaleString())
                .replace('{coin}', coin);
            
            let subtitle = template.subtitle
                .replace('{from}', wallet)
                .replace('{to}', exchange)
                .replace('{coin}', coin)
                .replace('{price}', price);
            
            const displayValue = template.type.includes('liquidation') ? '$' + liquidationValue : '$' + value;
            
            whaleAlerts.unshift({
                type: template.type,
                icon: template.icon,
                title: title,
                subtitle: subtitle,
                value: displayValue,
                animate: animate,
                time: new Date()
            });
            
            // Keep only last 8 alerts
            whaleAlerts = whaleAlerts.slice(0, 8);
            
            renderWhaleAlerts();
        }
        
        function renderWhaleAlerts() {
            const feed = document.getElementById('whaleFeed');
            if (!feed) return;
            
            feed.innerHTML = whaleAlerts.map((alert, i) => `
                <div class="whale-alert ${alert.type}" style="${alert.animate && i === 0 ? 'animation: slideInLeft 0.3s ease;' : ''}">
                    <span class="icon">${alert.icon}</span>
                    <div class="details">
                        <div class="title">${alert.title}</div>
                        <div class="subtitle">${alert.subtitle}</div>
                    </div>
                    <span class="value">${alert.value}</span>
                </div>
            `).join('');
        }
        
        // Top Movers
        let moversData = {
            gainers: [],
            losers: []
        };
        
        async function initTopMovers() {
            await updateTopMovers();
            // Update every 2 seconds (sync with heatmap)
            setInterval(updateTopMovers, 2000);
        }
        
        async function updateTopMovers() {
            // Use data from Binance if available
            if (marketData.length > 0) {
                updateMoversFromAPI();
            } else {
                // Try to fetch if not already loaded
                const gotReal = await fetchBinanceTickerData();
                if (gotReal) {
                    updateMoversFromAPI();
                } else {
                    updateMoversSimulated();
                }
            }
        }
        
        function updateMoversFromAPI() {
            // Filter for USDT pairs only and sort by 24h change
            const usdtPairs = marketData
                .filter(c => c.symbol.endsWith('USDT') && c.priceChangePercent !== null)
                .map(c => ({
                    symbol: c.symbol.replace('USDT', ''),
                    change: parseFloat(c.priceChangePercent)
                }))
                .filter(c => c.symbol.length <= 5); // Filter out weird pairs
            
            const sorted = [...usdtPairs].sort((a, b) => b.change - a.change);
            
            // Get top 5 gainers
            moversData.gainers = sorted.slice(0, 5);
            
            // Get top 5 losers (from bottom)
            moversData.losers = sorted.slice(-5).reverse();
            
            // Update badge to show LIVE
            const header = document.querySelector('.gainers-widget .widget-header');
            if (header && !header.querySelector('.widget-badge')) {
                const badge = document.createElement('span');
                badge.className = 'widget-badge live';
                badge.textContent = 'LIVE';
                header.appendChild(badge);
            }
            
            renderTopMovers();
        }
        
        function updateMoversSimulated() {
            const allCoins = ['SOL', 'AVAX', 'LINK', 'DOT', 'ATOM', 'NEAR', 'APT', 'ARB', 'OP', 'INJ', 
                             'DOGE', 'SHIB', 'PEPE', 'ADA', 'XRP', 'MATIC', 'FIL', 'LTC', 'UNI', 'AAVE'];
            
            // Generate random changes
            const changes = allCoins.map(coin => ({
                symbol: coin,
                change: (Math.random() - 0.5) * 20
            }));
            
            // Sort and get top 5 gainers and losers
            const sorted = [...changes].sort((a, b) => b.change - a.change);
            
            moversData.gainers = sorted.slice(0, 5).map(c => ({
                ...c,
                change: Math.abs(c.change) + Math.random() * 3 // Ensure positive
            }));
            
            moversData.losers = sorted.slice(-5).reverse().map(c => ({
                ...c,
                change: -(Math.abs(c.change) + Math.random() * 3) // Ensure negative
            }));
            
            renderTopMovers();
        }
        
        function renderTopMovers() {
            const gainersList = document.getElementById('gainersList');
            const losersList = document.getElementById('losersList');
            
            if (gainersList) {
                gainersList.innerHTML = moversData.gainers.map(coin => `
                    <div class="mover-row" onclick="selectPair('${coin.symbol}')">
                        <div class="coin">
                            <div class="coin-icon">${coin.symbol.slice(0, 2)}</div>
                            <span class="coin-symbol">${coin.symbol}</span>
                        </div>
                        <span class="change positive">+${Math.abs(coin.change).toFixed(2)}%</span>
                    </div>
                `).join('');
            }
            
            if (losersList) {
                losersList.innerHTML = moversData.losers.map(coin => `
                    <div class="mover-row" onclick="selectPair('${coin.symbol}')">
                        <div class="coin">
                            <div class="coin-icon">${coin.symbol.slice(0, 2)}</div>
                            <span class="coin-symbol">${coin.symbol}</span>
                        </div>
                        <span class="change negative">${coin.change.toFixed(2)}%</span>
                    </div>
                `).join('');
            }
        }
        
        // ===== TECHNICAL ANALYSIS =====
        let currentTaSymbol = 'BTC';
        
        function initTechnicalAnalysis() {
            updateTechnicalAnalysis();
            // Update every 10 seconds
            setInterval(updateTechnicalAnalysis, 10000);
        }
        
        function updateTechnicalAnalysis() {
            const symbol = currentTaSymbol;
            document.getElementById('taSymbol').textContent = symbol;
            
            // Simulate TA data (in production, use TradingView or TA-Lib API)
            const rsi = Math.floor(Math.random() * 40) + 30; // 30-70 range mostly
            const rsiClass = rsi > 70 ? 'overbought' : rsi < 30 ? 'oversold' : 'neutral';
            const rsiLabel = rsi > 70 ? 'Overbought' : rsi < 30 ? 'Oversold' : 'Neutral';
            
            // Update RSI bar
            const rsiBar = document.getElementById('taRsiBar');
            rsiBar.style.width = rsi + '%';
            rsiBar.style.background = rsi > 60 ? 'var(--cyan)' : rsi < 40 ? 'var(--pink)' : 'linear-gradient(90deg, var(--pink), var(--cyan))';
            
            const rsiValue = document.getElementById('taRsiValue');
            rsiValue.textContent = `${rsi} (${rsiLabel})`;
            rsiValue.style.color = rsi > 60 ? 'var(--cyan)' : rsi < 40 ? 'var(--pink)' : 'var(--text-secondary)';
            
            // MACD Signal
            const macdBullish = Math.random() > 0.4;
            const macdSignal = document.getElementById('taMacdSignal');
            macdSignal.textContent = macdBullish ? 'â†‘ Bullish Cross' : 'â†“ Bearish Cross';
            macdSignal.className = 'ta-signal ' + (macdBullish ? 'bullish' : 'bearish');
            
            // MA Signal
            const maBullish = Math.random() > 0.45;
            const maSignal = document.getElementById('taMaSignal');
            maSignal.textContent = maBullish ? 'â†‘ Golden Cross' : 'â†“ Death Cross';
            maSignal.className = 'ta-signal ' + (maBullish ? 'bullish' : 'bearish');
            
            // Support & Resistance (based on current price)
            const basePrices = { BTC: 87500, ETH: 3100, SOL: 220, XRP: 2.20, DOGE: 0.38 };
            const basePrice = basePrices[symbol] || 100;
            const support = basePrice * (0.95 + Math.random() * 0.03);
            const resistance = basePrice * (1.02 + Math.random() * 0.03);
            
            document.getElementById('taSupport').textContent = '$' + support.toLocaleString(undefined, { maximumFractionDigits: 2 });
            document.getElementById('taResistance').textContent = '$' + resistance.toLocaleString(undefined, { maximumFractionDigits: 2 });
            
            // Overall Summary
            const bullishSignals = (rsi > 50 ? 1 : 0) + (macdBullish ? 1 : 0) + (maBullish ? 1 : 0);
            const summary = document.getElementById('taSummary');
            const summaryValue = summary.querySelector('.summary-value');
            
            if (bullishSignals >= 2) {
                summary.className = 'ta-summary bullish';
                summaryValue.textContent = 'ðŸ“ˆ BULLISH';
            } else if (bullishSignals <= 1) {
                summary.className = 'ta-summary bearish';
                summaryValue.textContent = 'ðŸ“‰ BEARISH';
            } else {
                summary.className = 'ta-summary neutral';
                summaryValue.textContent = 'âž¡ï¸ NEUTRAL';
            }
        }
        
        // ===== FUNDING RATES =====
        function initFundingRates() {
            updateFundingRates();
            // Update every 30 seconds
            setInterval(updateFundingRates, 30000);
        }
        
        async function updateFundingRates() {
            const fundingList = document.getElementById('fundingList');
            if (!fundingList) return;
            
            // Try to fetch real funding rates from Binance
            let fundingData = [];
            
            try {
                const symbols = ['BTCUSDT', 'ETHUSDT', 'SOLUSDT', 'XRPUSDT', 'DOGEUSDT'];
                const response = await fetch('https://fapi.binance.com/fapi/v1/premiumIndex?symbol=BTCUSDT');
                
                if (response.ok) {
                    // Fetch all symbols
                    for (const symbol of symbols) {
                        try {
                            const res = await fetch(`https://fapi.binance.com/fapi/v1/premiumIndex?symbol=${symbol}`);
                            const data = await res.json();
                            if (data && data.lastFundingRate) {
                                fundingData.push({
                                    symbol: symbol.replace('USDT', ''),
                                    rate: parseFloat(data.lastFundingRate) * 100
                                });
                            }
                        } catch (e) {}
                    }
                }
            } catch (e) {
                // Use simulated data if API fails
            }
            
            // Fallback to simulated data
            if (fundingData.length === 0) {
                fundingData = [
                    { symbol: 'BTC', rate: (Math.random() - 0.3) * 0.05 },
                    { symbol: 'ETH', rate: (Math.random() - 0.4) * 0.05 },
                    { symbol: 'SOL', rate: (Math.random() - 0.2) * 0.06 },
                    { symbol: 'XRP', rate: (Math.random() - 0.5) * 0.04 },
                    { symbol: 'DOGE', rate: (Math.random() - 0.3) * 0.07 }
                ];
            }
            
            fundingList.innerHTML = fundingData.map(item => {
                const isPositive = item.rate >= 0;
                return `
                    <div class="funding-row">
                        <div class="coin">
                            <div class="coin-icon">${item.symbol.slice(0, 2)}</div>
                            <span>${item.symbol}</span>
                        </div>
                        <span class="rate ${isPositive ? 'positive' : 'negative'}">
                            ${isPositive ? '+' : ''}${item.rate.toFixed(4)}%
                        </span>
                        <span class="indicator">${isPositive ? 'ðŸŸ¢' : 'ðŸ”´'}</span>
                    </div>
                `;
            }).join('');
        }
        
        // ===== ECONOMIC CALENDAR =====
        function initEconomicCalendar() {
            renderEconomicCalendar();
            // Update daily
            setInterval(renderEconomicCalendar, 3600000);
        }
        
        function renderEconomicCalendar() {
            const calendarList = document.getElementById('calendarList');
            if (!calendarList) return;
            
            // Generate upcoming events based on current date
            const today = new Date();
            const events = [
                {
                    date: new Date(today.getTime() + 2 * 24 * 60 * 60 * 1000),
                    title: 'Fed Interest Rate Decision',
                    time: '2:00 PM EST',
                    impact: 'high'
                },
                {
                    date: new Date(today.getTime() + 4 * 24 * 60 * 60 * 1000),
                    title: 'BTC Options Expiry ($2.1B)',
                    time: '8:00 AM UTC',
                    impact: 'high'
                },
                {
                    date: new Date(today.getTime() + 5 * 24 * 60 * 60 * 1000),
                    title: 'ETH Futures Expiry',
                    time: '8:00 AM UTC',
                    impact: 'medium'
                },
                {
                    date: new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000),
                    title: 'US GDP Report Q4',
                    time: '8:30 AM EST',
                    impact: 'medium'
                },
                {
                    date: new Date(today.getTime() + 10 * 24 * 60 * 60 * 1000),
                    title: 'PCE Inflation Data',
                    time: '8:30 AM EST',
                    impact: 'high'
                }
            ];
            
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            calendarList.innerHTML = events.slice(0, 4).map(event => `
                <div class="calendar-event ${event.impact}">
                    <div class="event-date">
                        <div class="event-day">${event.date.getDate()}</div>
                        <div class="event-month">${months[event.date.getMonth()]}</div>
                    </div>
                    <div class="event-details">
                        <div class="event-title">${event.title}</div>
                        <div class="event-time">${event.time}</div>
                    </div>
                    <span class="event-impact">${event.impact.toUpperCase()}</span>
                </div>
            `).join('');
        }
        
        async function initMarketIntelligence() {
            await initHeatmap();
            initWhaleAlerts();
            await initTopMovers();
            initTechnicalAnalysis();
            initFundingRates();
            initEconomicCalendar();
        }

        // ===== WIDGETS =====
        let currentFearGreed = 72;
        
        async function initFearGreed() {
            // Show loading state
            document.getElementById('fgValue').textContent = '...';
            
            try {
                // Fetch real Fear & Greed Index from alternative.me API
                const response = await fetch('https://api.alternative.me/fng/?limit=1');
                const data = await response.json();
                
                if (data && data.data && data.data[0]) {
                    const fgData = data.data[0];
                    currentFearGreed = parseInt(fgData.value);
                    const classification = fgData.value_classification;
                    
                    updateFearGreedDisplay(currentFearGreed, classification);
                    
                    // Show live indicator
                    const source = document.getElementById('fgSource');
                    if (source) source.textContent = 'ðŸŸ¢ Live from alternative.me';
                    
                    
                }
            } catch (error) {
                
                // Start with a random value between 20-80
                currentFearGreed = Math.floor(Math.random() * 60) + 20;
                updateFearGreedDisplay(currentFearGreed);
                
                // Show simulated indicator
                const source = document.getElementById('fgSource');
                if (source) source.textContent = 'âšª Simulated â€¢ Updates every 30s';
                
                // Simulate changes every 30 seconds
                setInterval(() => {
                    // 20% chance of big swing (-12 to +12), otherwise small (-3 to +3)
                    const bigSwing = Math.random() < 0.2;
                    const change = bigSwing 
                        ? Math.floor(Math.random() * 25) - 12 
                        : Math.floor(Math.random() * 7) - 3;
                    
                    currentFearGreed += change;
                    // Keep in bounds 5-95
                    currentFearGreed = Math.max(5, Math.min(95, currentFearGreed));
                    updateFearGreedDisplay(currentFearGreed);
                }, 30000);
            }
        }

        function updateFearGreedDisplay(value, classification = null) {
            document.getElementById('fgValue').textContent = value;
            document.getElementById('fgNeedle').style.left = value + '%';
            
            // Determine classification if not provided
            if (!classification) {
                if (value < 25) classification = 'Extreme Fear';
                else if (value < 45) classification = 'Fear';
                else if (value < 55) classification = 'Neutral';
                else if (value < 75) classification = 'Greed';
                else classification = 'Extreme Greed';
            }
            document.getElementById('fgClassification').textContent = `(${classification})`;
            
            // Set color based on value
            let color = 'var(--cyan)';
            if (value < 25) color = '#ff1493';
            else if (value < 45) color = '#ff6b6b';
            else if (value < 55) color = '#ffa500';
            else if (value < 75) color = '#90EE90';
            else color = 'var(--cyan)';
            
            document.getElementById('fgValue').style.color = color;
        }

        function initPortfolio() {
            const canvas = document.getElementById('portfolioChart');
            const ctx = canvas.getContext('2d');
            canvas.width = 80;
            canvas.height = 80;

            const data = [
                { name: 'BTC', value: 45, color: '#f7931a' },
                { name: 'ETH', value: 25, color: '#627eea' },
                { name: 'MX1', value: 20, color: '#00d4ff' },
                { name: 'Other', value: 10, color: '#8a2be2' }
            ];

            let start = 0;
            data.forEach(d => {
                const angle = (d.value / 100) * Math.PI * 2;
                ctx.beginPath();
                ctx.moveTo(40, 40);
                ctx.arc(40, 40, 35, start, start + angle);
                ctx.fillStyle = d.color;
                ctx.fill();
                start += angle;
            });

            // Center hole
            ctx.beginPath();
            ctx.arc(40, 40, 20, 0, Math.PI * 2);
            ctx.fillStyle = 'var(--bg-secondary)';
            ctx.fill();

            // Legend
            document.getElementById('portfolioLegend').innerHTML = data.map(d => `
                <div class="legend-item">
                    <div class="legend-color" style="background: ${d.color}"></div>
                    <span class="legend-name">${d.name}</span>
                    <span class="legend-percent">${d.value}%</span>
                </div>
            `).join('');
        }

        function initNews() {
            const news = [
                { headline: 'MX1 Token Surges 8% on New Exchange Listing Announcement', source: 'CryptoNews', time: '2m ago' },
                { headline: 'Bitcoin Approaches $105K as Institutional Demand Grows', source: 'Bloomberg', time: '15m ago' },
                { headline: 'Ethereum L2 Solutions See Record Transaction Volume', source: 'The Block', time: '1h ago' }
            ];
            document.getElementById('newsFeed').innerHTML = news.map(n => `
                <div class="news-item">
                    <div class="news-headline">${n.headline}</div>
                    <div class="news-meta">
                        <span class="news-source">${n.source}</span>
                        <span>${n.time}</span>
                    </div>
                </div>
            `).join('');
        }

        // ===== INIT =====
        function init() {
            initTicker();
            initPairDropdown();
            initTradingView();
            initFearGreed();
            initPortfolio();
            initNews();
            initSentiment();
            initMarketIntelligence();
            startCountdown();
            
            // Initialize particles
            initParticles();
            
            // Add ripple effect to buttons
            initRippleEffects();
            
            // Show connecting message for order book
            document.getElementById('asksList').innerHTML = '<div style="text-align: center; color: var(--text-muted); padding: 10px; font-size: 11px;">Connecting...</div>';
            document.getElementById('bidsList').innerHTML = '<div style="text-align: center; color: var(--text-muted); padding: 10px; font-size: 11px;">Connecting...</div>';
            
            // Show connecting message for trades
            initRecentTrades();
            
            // Draw initial depth chart (will be updated by live data)
            drawDepthChart();

            // Try to connect to Binance WebSocket
            connectBinanceWebSocket();
            
            // Immediately try to fetch data
            fetchLiveData();
            
            // If nothing works after 2 seconds, start simulation
            setTimeout(() => {
                if (!wsConnected && !simulationMode) {
                    
                    startSimulation();
                }
            }, 2000);
        }

        // ===== EPIC PARTICLE SYSTEM =====
        function initParticles() {
            const canvas = document.getElementById('particleCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const particles = [];
            const particleCount = 50;
            
            // Particle class
            class Particle {
                constructor() {
                    this.reset();
                }
                
                reset() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height;
                    this.size = Math.random() * 3 + 1;
                    this.speedX = (Math.random() - 0.5) * 0.5;
                    this.speedY = (Math.random() - 0.5) * 0.5;
                    this.opacity = Math.random() * 0.5 + 0.2;
                    this.color = Math.random() > 0.5 ? '0, 212, 255' : '138, 43, 226';
                }
                
                update() {
                    this.x += this.speedX;
                    this.y += this.speedY;
                    
                    if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
                    if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
                }
                
                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(${this.color}, ${this.opacity})`;
                    ctx.fill();
                    
                    // Glow effect
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = `rgba(${this.color}, 0.5)`;
                }
            }
            
            // Create particles
            for (let i = 0; i < particleCount; i++) {
                particles.push(new Particle());
            }
            
            // Animation loop
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw connections
                particles.forEach((p1, i) => {
                    particles.slice(i + 1).forEach(p2 => {
                        const dx = p1.x - p2.x;
                        const dy = p1.y - p2.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        
                        if (dist < 150) {
                            ctx.beginPath();
                            ctx.moveTo(p1.x, p1.y);
                            ctx.lineTo(p2.x, p2.y);
                            ctx.strokeStyle = `rgba(0, 212, 255, ${0.1 * (1 - dist / 150)})`;
                            ctx.lineWidth = 0.5;
                            ctx.stroke();
                        }
                    });
                });
                
                // Update and draw particles
                particles.forEach(p => {
                    p.update();
                    p.draw();
                });
                
                requestAnimationFrame(animate);
            }
            
            animate();
            
            // Resize handler
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }

        // ===== CONFETTI EXPLOSION =====
        function triggerConfetti() {
            const colors = ['#00d4ff', '#8a2be2', '#ff1493', '#ffd700', '#00ff88'];
            const confettiCount = 100;
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-10px';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                
                // Random shapes
                if (Math.random() > 0.5) {
                    confetti.style.borderRadius = '50%';
                } else {
                    confetti.style.width = '8px';
                    confetti.style.height = '16px';
                }
                
                document.body.appendChild(confetti);
                
                // Remove after animation
                setTimeout(() => confetti.remove(), 4000);
            }
        }

        // ===== RIPPLE EFFECT =====
        function initRippleEffects() {
            const buttons = document.querySelectorAll('.submit-btn, .wallet-btn, .alert-btn, .trade-tab, .percent-btn');
            
            buttons.forEach(btn => {
                btn.classList.add('ripple-btn');
                btn.addEventListener('click', function(e) {
                    const ripple = document.createElement('span');
                    ripple.className = 'ripple';
                    
                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    
                    ripple.style.width = ripple.style.height = size + 'px';
                    ripple.style.left = e.clientX - rect.left - size / 2 + 'px';
                    ripple.style.top = e.clientY - rect.top - size / 2 + 'px';
                    
                    this.appendChild(ripple);
                    
                    setTimeout(() => ripple.remove(), 600);
                });
            });
        }

        // ===== SMOOTH NUMBER COUNTING =====
        function animateNumber(element, newValue, duration = 500) {
            const startValue = parseFloat(element.textContent.replace(/[^0-9.-]/g, '')) || 0;
            const startTime = performance.now();
            const isUp = newValue > startValue;
            
            element.classList.remove('counting-up', 'counting-down');
            element.classList.add(isUp ? 'counting-up' : 'counting-down');
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function
                const easeOut = 1 - Math.pow(1 - progress, 3);
                const currentValue = startValue + (newValue - startValue) * easeOut;
                
                // Format based on value size
                if (newValue > 1000) {
                    element.textContent = currentValue.toLocaleString(undefined, {maximumFractionDigits: 2});
                } else {
                    element.textContent = currentValue.toFixed(4);
                }
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                } else {
                    setTimeout(() => {
                        element.classList.remove('counting-up', 'counting-down');
                    }, 300);
                }
            }
            
            requestAnimationFrame(update);
        }

        // ===== LOADING SKELETON =====
        function showLoadingSkeleton() {
            // Market dropdown skeleton
            const dropdownList = document.getElementById('pairDropdownList');
            if (dropdownList) {
                dropdownList.innerHTML = Array(8).fill().map(() => `
                    <div class="skeleton-row">
                        <div class="skeleton skeleton-circle"></div>
                        <div style="flex:1">
                            <div class="skeleton skeleton-text long"></div>
                            <div class="skeleton skeleton-text short"></div>
                        </div>
                        <div class="skeleton skeleton-text"></div>
                        <div class="skeleton skeleton-text short"></div>
                    </div>
                `).join('');
            }
            
            // Order book skeleton
            const asksList = document.getElementById('asksList');
            const bidsList = document.getElementById('bidsList');
            if (asksList && bidsList) {
                const skeletonRows = Array(5).fill().map(() => `
                    <div class="skeleton-row" style="padding: 4px 0;">
                        <div class="skeleton skeleton-text"></div>
                        <div class="skeleton skeleton-text"></div>
                        <div class="skeleton skeleton-text short"></div>
                    </div>
                `).join('');
                asksList.innerHTML = skeletonRows;
                bidsList.innerHTML = skeletonRows;
            }
            
            // Trades skeleton
            const tradesList = document.getElementById('tradesList');
            if (tradesList) {
                tradesList.innerHTML = Array(10).fill().map(() => `
                    <div class="skeleton-row" style="padding: 6px 0;">
                        <div class="skeleton skeleton-text"></div>
                        <div class="skeleton skeleton-text"></div>
                        <div class="skeleton skeleton-text short"></div>
                    </div>
                `).join('');
            }
        }

        function hideLoadingSkeleton() {
            isLoading = false;
            // Data will be loaded by normal init functions
        }

        // Funding countdown timer
        function startCountdown() {
            let hours = 4;
            let minutes = 32;
            let seconds = 15;
            
            setInterval(() => {
                seconds--;
                if (seconds < 0) {
                    seconds = 59;
                    minutes--;
                }
                if (minutes < 0) {
                    minutes = 59;
                    hours--;
                }
                if (hours < 0) {
                    hours = 7;
                    minutes = 59;
                    seconds = 59;
                }
                
                const countdown = document.getElementById('countdown');
                if (countdown) {
                    countdown.textContent = 
                        String(hours).padStart(2, '0') + ':' + 
                        String(minutes).padStart(2, '0') + ':' + 
                        String(seconds).padStart(2, '0');
                }
            }, 1000);
        }

        window.addEventListener('load', init);
        window.addEventListener('resize', () => {
            drawDepthChart();
        });
    </script>
</body>
</html>
